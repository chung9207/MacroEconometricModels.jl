<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bayesian FEVD (posterior mean)</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(33% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">Bayesian FEVD (posterior mean)</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">INDPRO</div>
<div id="bfevd_43"></div>
</div>
<div class="panel">
<div class="panel-title">UNRATE</div>
<div id="bfevd_44"></div>
</div>
<div class="panel">
<div class="panel-title">CPI</div>
<div id="bfevd_45"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":1,"s1":1.0,"s2":0.0,"s3":0.0},
{"x":2,"s1":0.870536557720594,"s2":0.004099823475689985,"s3":0.12536361880371613},
{"x":3,"s1":0.7561368735238965,"s2":0.0094883703743527,"s3":0.2343747561017509},
{"x":4,"s1":0.6871066962184064,"s2":0.011915756529747499,"s3":0.30097754725184617},
{"x":5,"s1":0.6429779513705275,"s2":0.013792137409699007,"s3":0.34322991121977353},
{"x":6,"s1":0.6287513686520366,"s2":0.014842128748525885,"s3":0.3564065025994375},
{"x":7,"s1":0.6190698351233228,"s2":0.01572654644501165,"s3":0.3652036184316655},
{"x":8,"s1":0.612538806012232,"s2":0.017425989411194897,"s3":0.3700352045765731},
{"x":9,"s1":0.6083630598840518,"s2":0.017892461294901244,"s3":0.37374447882104705},
{"x":10,"s1":0.6012560248846306,"s2":0.01847628273727042,"s3":0.3802676923780991},
{"x":11,"s1":0.5973958217361671,"s2":0.019047084091879253,"s3":0.3835570941719536},
{"x":12,"s1":0.5942341745347108,"s2":0.01935140459717701,"s3":0.3864144208681122},
{"x":13,"s1":0.5917896104427683,"s2":0.019792222444674074,"s3":0.38841816711255767},
{"x":14,"s1":0.5895134348292048,"s2":0.019753954381046872,"s3":0.3907326107897483},
{"x":15,"s1":0.5887750074502824,"s2":0.019846840284828946,"s3":0.3913781522648887},
{"x":16,"s1":0.5870373074043911,"s2":0.019794705745733464,"s3":0.3931679868498754},
{"x":17,"s1":0.584593234832503,"s2":0.019973769853560565,"s3":0.39543299531393644},
{"x":18,"s1":0.5834150170572916,"s2":0.020096973143168998,"s3":0.3964880097995395},
{"x":19,"s1":0.5826850415270587,"s2":0.020278400077905975,"s3":0.39703655839503543},
{"x":20,"s1":0.5806856953291833,"s2":0.0202540420206397,"s3":0.3990602626501769}];
    const series = [{"name":"INDPRO","color":"#1f77b4","key":"s1","dash":""},{"name":"UNRATE","color":"#ff7f0e","key":"s2","dash":""},{"name":"CPI","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#bfevd_43');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"s1":0.004847912483013719,"s2":0.9951520875169863,"s3":0.0},
{"x":2,"s1":0.23838598308421144,"s2":0.5979970182959051,"s3":0.16361699861988346},
{"x":3,"s1":0.451036108657457,"s2":0.38667996684274614,"s3":0.1622839244997969},
{"x":4,"s1":0.4786686316513299,"s2":0.30856106108494363,"s3":0.2127703072637266},
{"x":5,"s1":0.4773521497380462,"s2":0.24059311405743009,"s3":0.2820547362045237},
{"x":6,"s1":0.4779106966890437,"s2":0.209404481805396,"s3":0.3126848215055604},
{"x":7,"s1":0.47469467137551746,"s2":0.19035683598883393,"s3":0.3349484926356487},
{"x":8,"s1":0.46986106784429177,"s2":0.18033803615333416,"s3":0.34980089600237413},
{"x":9,"s1":0.46751833731648684,"s2":0.16801421121369742,"s3":0.3644674514698158},
{"x":10,"s1":0.46898694012759157,"s2":0.1606722386923081,"s3":0.37034082118010025},
{"x":11,"s1":0.47077930091213815,"s2":0.15498804025590227,"s3":0.3742326588319595},
{"x":12,"s1":0.4715944108067613,"s2":0.15041748271136907,"s3":0.37798810648186965},
{"x":13,"s1":0.47094581376996414,"s2":0.14684171554317688,"s3":0.3822124706868591},
{"x":14,"s1":0.4679288090019876,"s2":0.14445213334609594,"s3":0.3876190576519165},
{"x":15,"s1":0.4674686710480732,"s2":0.14213332481011348,"s3":0.3903980041418132},
{"x":16,"s1":0.4660301867219655,"s2":0.13999760332419262,"s3":0.39397220995384197},
{"x":17,"s1":0.46747741568141465,"s2":0.13767666740856077,"s3":0.39484591691002463},
{"x":18,"s1":0.46838951289282155,"s2":0.13541101641271056,"s3":0.39619947069446804},
{"x":19,"s1":0.4691164399295784,"s2":0.13395986170799382,"s3":0.39692369836242775},
{"x":20,"s1":0.46923608608961853,"s2":0.13236239253146903,"s3":0.3984015213789125}];
    const series = [{"name":"INDPRO","color":"#1f77b4","key":"s1","dash":""},{"name":"UNRATE","color":"#ff7f0e","key":"s2","dash":""},{"name":"CPI","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#bfevd_44');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"s1":0.0028466715182860476,"s2":0.004526526659903885,"s3":0.9926268018218101},
{"x":2,"s1":0.08884498512343988,"s2":0.007395716289063195,"s3":0.9037592985874969},
{"x":3,"s1":0.15749265449193012,"s2":0.010118807766908735,"s3":0.8323885377411612},
{"x":4,"s1":0.2152462118610749,"s2":0.012986787389422513,"s3":0.7717670007495027},
{"x":5,"s1":0.24298236362215656,"s2":0.017267335692275156,"s3":0.7397503006855682},
{"x":6,"s1":0.25617291311276735,"s2":0.01862413372257322,"s3":0.7252029531646595},
{"x":7,"s1":0.26265437970193833,"s2":0.019030050855614544,"s3":0.7183155694424472},
{"x":8,"s1":0.27193915962353105,"s2":0.019610226824543286,"s3":0.7084506135519257},
{"x":9,"s1":0.2808312945362611,"s2":0.020484806051162714,"s3":0.6986838994125762},
{"x":10,"s1":0.2841406506280112,"s2":0.02057958890952582,"s3":0.695279760462463},
{"x":11,"s1":0.288531258469064,"s2":0.02091199387770924,"s3":0.6905567476532267},
{"x":12,"s1":0.2920387194881341,"s2":0.021062009616113278,"s3":0.6868992708957526},
{"x":13,"s1":0.2947415041416552,"s2":0.021470748857907736,"s3":0.6837877470004371},
{"x":14,"s1":0.2944074792303922,"s2":0.021874299975306426,"s3":0.6837182207943013},
{"x":15,"s1":0.2959004300852568,"s2":0.022264970630133486,"s3":0.6818345992846098},
{"x":16,"s1":0.29969632345809105,"s2":0.02238726979535985,"s3":0.6779164067465492},
{"x":17,"s1":0.3024077754705427,"s2":0.0222786164573213,"s3":0.675313608072136},
{"x":18,"s1":0.30416008235904823,"s2":0.022393985053575156,"s3":0.6734459325873766},
{"x":19,"s1":0.3049963850456533,"s2":0.022471442329781557,"s3":0.6725321726245652},
{"x":20,"s1":0.30675753790553945,"s2":0.02257088631780949,"s3":0.670671575776651}];
    const series = [{"name":"INDPRO","color":"#1f77b4","key":"s1","dash":""},{"name":"UNRATE","color":"#ff7f0e","key":"s2","dash":""},{"name":"CPI","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#bfevd_45');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>