<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Beveridge-Nelson Decomposition (ARIMA(2,1,1))</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(100% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">Beveridge-Nelson Decomposition (ARIMA(2,1,1))</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">Trend-Cycle Decomposition</div>
<div id="filt_tc_65"></div>
</div>
<div class="panel">
<div class="panel-title">Cyclical Component</div>
<div id="filt_cy_66"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":1,"trend":4.026925451723441,"cycle":0.0,"orig":4.026925451723441,"zero":0},
{"x":2,"trend":4.050293429153814,"cycle":-0.010273065662313036,"orig":4.040020363491501,"zero":0},
{"x":3,"trend":4.050123723345808,"cycle":-0.008656165057808966,"orig":4.041467558288,"zero":0},
{"x":4,"trend":4.055164707268839,"cycle":-0.007386034749702814,"orig":4.047778672519136,"zero":0},
{"x":5,"trend":4.063069057719749,"cycle":-0.008987618437944236,"orig":4.054081439281805,"zero":0},
{"x":6,"trend":4.068059945974408,"cycle":-0.008812477389769363,"orig":4.059247468584639,"zero":0},
{"x":7,"trend":4.075905179763181,"cycle":-0.009860645704575685,"orig":4.066044534058605,"zero":0},
{"x":8,"trend":4.0853887563915965,"cycle":-0.011866140795153373,"orig":4.073522615596443,"zero":0},
{"x":9,"trend":4.087338527900795,"cycle":-0.009884138291445334,"orig":4.07745438960935,"zero":0},
{"x":10,"trend":4.106935261732011,"cycle":-0.016247377013454495,"orig":4.090687884718557,"zero":0},
{"x":11,"trend":4.111338095245006,"cycle":-0.01578426448292046,"orig":4.095553830762086,"zero":0},
{"x":12,"trend":4.113697745846823,"cycle":-0.012551368505794153,"orig":4.101146377341029,"zero":0},
{"x":13,"trend":4.106508703400528,"cycle":-0.005559334348556679,"orig":4.100949369051971,"zero":0},
{"x":14,"trend":4.11017932928215,"cycle":-0.004230688889536696,"orig":4.105948640392613,"zero":0},
{"x":15,"trend":4.111797697540901,"cycle":-0.003384234723341053,"orig":4.10841346281756,"zero":0},
{"x":16,"trend":4.119212761656242,"cycle":-0.005014919826040346,"orig":4.114197841830202,"zero":0},
{"x":17,"trend":4.112035483455546,"cycle":0.00014408529146769044,"orig":4.112179568747014,"zero":0},
{"x":18,"trend":4.1134243244460125,"cycle":0.0016521716951689825,"orig":4.115076496141182,"zero":0},
{"x":19,"trend":4.112286933198099,"cycle":0.0029364743753404897,"orig":4.11522340757344,"zero":0},
{"x":20,"trend":4.120060202036571,"cycle":0.000164884815105972,"orig":4.120225086851677,"zero":0},
{"x":21,"trend":4.112748353643083,"cycle":0.004347099849721772,"orig":4.117095453492804,"zero":0},
{"x":22,"trend":4.118347566249533,"cycle":0.0030494236338843555,"orig":4.121396989883417,"zero":0},
{"x":23,"trend":4.1229453928062325,"cycle":0.0008673526649046723,"orig":4.123812745471137,"zero":0},
{"x":24,"trend":4.129842802514594,"cycle":-0.0015107478653802581,"orig":4.128332054649214,"zero":0},
{"x":25,"trend":4.133494130890621,"cycle":-0.002216727108928283,"orig":4.131277403781692,"zero":0},
{"x":26,"trend":4.121628635948565,"cycle":0.005213770991196665,"orig":4.126842406939762,"zero":0},
{"x":27,"trend":4.123512550777935,"cycle":0.005827464591408121,"orig":4.129340015369343,"zero":0},
{"x":28,"trend":4.123551395462443,"cycle":0.005638939185255698,"orig":4.129190334647699,"zero":0},
{"x":29,"trend":4.11142604958097,"cycle":0.01206298957959913,"orig":4.123489039160569,"zero":0},
{"x":30,"trend":4.110831244317112,"cycle":0.012581708652335294,"orig":4.123412952969447,"zero":0},
{"x":31,"trend":4.094075269469823,"cycle":0.019643723810368913,"orig":4.113718993280192,"zero":0},
{"x":32,"trend":4.114485100504465,"cycle":0.008984512944879171,"orig":4.123469613449345,"zero":0},
{"x":33,"trend":4.113315412656833,"cycle":0.007015234202964527,"orig":4.120330646859798,"zero":0},
{"x":34,"trend":4.109047366960234,"cycle":0.009934521771145533,"orig":4.11898188873138,"zero":0},
{"x":35,"trend":4.116185427661352,"cycle":0.0061698135112423025,"orig":4.1223552411725946,"zero":0},
{"x":36,"trend":4.127810446697464,"cycle":1.4022765239757819e-5,"orig":4.127824469462704,"zero":0},
{"x":37,"trend":4.1168427066240705,"cycle":0.005911130071707858,"orig":4.122753836695779,"zero":0},
{"x":38,"trend":4.131622020074845,"cycle":0.0001724575940930011,"orig":4.131794477668938,"zero":0},
{"x":39,"trend":4.142031854985796,"cycle":-0.0052681743251091805,"orig":4.136763680660687,"zero":0},
{"x":40,"trend":4.133232107749383,"cycle":0.0009083227054212178,"orig":4.134140430454805,"zero":0},
{"x":41,"trend":4.135012916258892,"cycle":0.0021644175156418973,"orig":4.137177333774534,"zero":0},
{"x":42,"trend":4.1405632902220715,"cycle":-1.2142058758049756e-7,"orig":4.140563168801484,"zero":0},
{"x":43,"trend":4.1351911516970485,"cycle":0.00362314394890196,"orig":4.13881429564595,"zero":0},
{"x":44,"trend":4.139486211961466,"cycle":0.002814833681488675,"orig":4.142301045642955,"zero":0},
{"x":45,"trend":4.139032737354952,"cycle":0.003344559402021386,"orig":4.142377296756973,"zero":0},
{"x":46,"trend":4.125649858116745,"cycle":0.010867785496551385,"orig":4.136517643613296,"zero":0},
{"x":47,"trend":4.099452281574726,"cycle":0.024268218273764755,"orig":4.12372049984849,"zero":0},
{"x":48,"trend":4.086981637124664,"cycle":0.02937226613569284,"orig":4.116353903260356,"zero":0},
{"x":49,"trend":4.087319317974917,"cycle":0.02577339420887579,"orig":4.113092712183793,"zero":0},
{"x":50,"trend":4.079667963081323,"cycle":0.026008813037442204,"orig":4.105676776118765,"zero":0},
{"x":51,"trend":4.073513808434579,"cycle":0.026391928417894193,"orig":4.099905736852473,"zero":0},
{"x":52,"trend":4.084776802204413,"cycle":0.01776407824217369,"orig":4.102540880446586,"zero":0},
{"x":53,"trend":4.109046106632173,"cycle":0.002864924415611361,"orig":4.111911031047784,"zero":0},
{"x":54,"trend":4.126926942824802,"cycle":-0.006945498527964065,"orig":4.1199814442968385,"zero":0},
{"x":55,"trend":4.129381031062395,"cycle":-0.006602894899987851,"orig":4.122778136162407,"zero":0},
{"x":56,"trend":4.124138297854866,"cycle":-0.0013715013700722075,"orig":4.122766796484794,"zero":0},
{"x":57,"trend":4.13558957426972,"cycle":-0.004921118833803362,"orig":4.1306684554359165,"zero":0},
{"x":58,"trend":4.132328265738153,"cycle":-0.0022064121405310122,"orig":4.130121853597622,"zero":0},
{"x":59,"trend":4.124527751808625,"cycle":0.004010486083454039,"orig":4.128538237892079,"zero":0},
{"x":60,"trend":4.1126494675656415,"cycle":0.011014386016915016,"orig":4.123663853582556,"zero":0},
{"x":61,"trend":4.101778522819304,"cycle":0.016634066736497116,"orig":4.118412589555801,"zero":0},
{"x":62,"trend":4.117447389534317,"cycle":0.008000089613774172,"orig":4.125447479148091,"zero":0},
{"x":63,"trend":4.137467226042511,"cycle":-0.0035302248939207874,"orig":4.13393700114859,"zero":0},
{"x":64,"trend":4.15103026654486,"cycle":-0.009531798729473323,"orig":4.141498467815387,"zero":0},
{"x":65,"trend":4.153035315232785,"cycle":-0.008251156252614586,"orig":4.14478415898017,"zero":0},
{"x":66,"trend":4.148282256405679,"cycle":-0.002986374929525887,"orig":4.145295881476153,"zero":0},
{"x":67,"trend":4.16170762637194,"cycle":-0.007246806822854898,"orig":4.154460819549085,"zero":0},
{"x":68,"trend":4.14800018318845,"cycle":0.0008530817840041498,"orig":4.148853264972454,"zero":0},
{"x":69,"trend":4.148936446746004,"cycle":0.0032099333983513774,"orig":4.152146380144355,"zero":0},
{"x":70,"trend":4.16164621045001,"cycle":-0.0027709396208560576,"orig":4.158875270829154,"zero":0},
{"x":71,"trend":4.167358225476887,"cycle":-0.004697909849438554,"orig":4.162660315627448,"zero":0},
{"x":72,"trend":4.16676282207845,"cycle":-0.002415010084601223,"orig":4.164347811993848,"zero":0},
{"x":73,"trend":4.170496328008808,"cycle":-0.002315973527714617,"orig":4.168180354481093,"zero":0},
{"x":74,"trend":4.177135078087011,"cycle":-0.00415032972659328,"orig":4.172984748360418,"zero":0},
{"x":75,"trend":4.172210737147006,"cycle":-9.990251895696995e-5,"orig":4.172110834628049,"zero":0},
{"x":76,"trend":4.173721384023903,"cycle":0.001128855607782539,"orig":4.174850239631685,"zero":0},
{"x":77,"trend":4.164567201967288,"cycle":0.006491457322517293,"orig":4.171058659289805,"zero":0},
{"x":78,"trend":4.166845877276167,"cycle":0.006465429363172443,"orig":4.173311306639339,"zero":0},
{"x":79,"trend":4.172657161191993,"cycle":0.0033472619446587642,"orig":4.176004423136652,"zero":0},
{"x":80,"trend":4.169576087274936,"cycle":0.0052218675088853885,"orig":4.174797954783822,"zero":0},
{"x":81,"trend":4.1783887901770305,"cycle":0.0017006529225263654,"orig":4.180089443099557,"zero":0},
{"x":82,"trend":4.1924224729971895,"cycle":-0.0050293774753299705,"orig":4.18739309552186,"zero":0},
{"x":83,"trend":4.1988756759512516,"cycle":-0.006923574876142737,"orig":4.191952101075109,"zero":0},
{"x":84,"trend":4.205889584431758,"cycle":-0.008032212509619876,"orig":4.197857371922138,"zero":0},
{"x":85,"trend":4.20703765670014,"cycle":-0.006306605311073451,"orig":4.2007310513890666,"zero":0},
{"x":86,"trend":4.20313166725918,"cycle":-0.0018178840398370836,"orig":4.2013137832193435,"zero":0},
{"x":87,"trend":4.219058233911237,"cycle":-0.007594560085261961,"orig":4.211463673825975,"zero":0},
{"x":88,"trend":4.22822535955033,"cycle":-0.010865547681702193,"orig":4.2173598118686275,"zero":0},
{"x":89,"trend":4.231444689575091,"cycle":-0.00949438174791637,"orig":4.221950307827175,"zero":0},
{"x":90,"trend":4.23891264135376,"cycle":-0.01023388383944912,"orig":4.228678757514311,"zero":0},
{"x":91,"trend":4.2363844039678185,"cycle":-0.00637614077400846,"orig":4.23000826319381,"zero":0},
{"x":92,"trend":4.24374283142308,"cycle":-0.007052710716343284,"orig":4.2366901207067365,"zero":0},
{"x":93,"trend":4.2462077901232265,"cycle":-0.006377120154937941,"orig":4.239830669968288,"zero":0},
{"x":94,"trend":4.256983251752158,"cycle":-0.009139650546011407,"orig":4.247843601206147,"zero":0},
{"x":95,"trend":4.266296046445312,"cycle":-0.011639822282480299,"orig":4.254656224162832,"zero":0},
{"x":96,"trend":4.280520192908697,"cycle":-0.01569754282363219,"orig":4.264822650085065,"zero":0},
{"x":97,"trend":4.277743506208359,"cycle":-0.011220319925356527,"orig":4.266523186283003,"zero":0},
{"x":98,"trend":4.267706171367561,"cycle":-0.002311672389569901,"orig":4.265394498977991,"zero":0},
{"x":99,"trend":4.265971604826933,"cycle":0.0010831953093454686,"orig":4.267054800136278,"zero":0},
{"x":100,"trend":4.260372284173425,"cycle":0.004954790172636852,"orig":4.265327074346062,"zero":0},
{"x":101,"trend":4.268060492131199,"cycle":0.0021654891999815895,"orig":4.270225981331181,"zero":0},
{"x":102,"trend":4.274285808187028,"cycle":-0.0007509754236442286,"orig":4.273534832763384,"zero":0},
{"x":103,"trend":4.263741041559056,"cycle":0.005603898464222042,"orig":4.269344940023278,"zero":0},
{"x":104,"trend":4.286880884589572,"cycle":-0.004366621573842939,"orig":4.282514263015729,"zero":0},
{"x":105,"trend":4.295189018172737,"cycle":-0.008649578969528436,"orig":4.286539439203208,"zero":0},
{"x":106,"trend":4.286120682100366,"cycle":-0.0013403503080635687,"orig":4.2847803317923026,"zero":0},
{"x":107,"trend":4.286460092590057,"cycle":0.0009522450968779447,"orig":4.287412337686935,"zero":0},
{"x":108,"trend":4.2914314929837705,"cycle":-0.0005543308737513915,"orig":4.290877162110019,"zero":0},
{"x":109,"trend":4.278000798648018,"cycle":0.007136284670632839,"orig":4.285137083318651,"zero":0},
{"x":110,"trend":4.303826182917794,"cycle":-0.004159939672677184,"orig":4.299666243245117,"zero":0},
{"x":111,"trend":4.302518513675276,"cycle":-0.004077313059199741,"orig":4.298441200616076,"zero":0},
{"x":112,"trend":4.316120881366241,"cycle":-0.007778462489644297,"orig":4.308342418876597,"zero":0},
{"x":113,"trend":4.328137221681117,"cycle":-0.012349219181595554,"orig":4.315788002499521,"zero":0},
{"x":114,"trend":4.33726284572901,"cycle":-0.013881464988304937,"orig":4.323381380740705,"zero":0},
{"x":115,"trend":4.3311385566871605,"cycle":-0.007603429910745422,"orig":4.323535126776415,"zero":0},
{"x":116,"trend":4.334316915998395,"cycle":-0.005676553937404373,"orig":4.32864036206099,"zero":0},
{"x":117,"trend":4.342800644778063,"cycle":-0.00792065059885852,"orig":4.334879994179205,"zero":0},
{"x":118,"trend":4.339084753451595,"cycle":-0.003908665222372032,"orig":4.335176088229223,"zero":0},
{"x":119,"trend":4.351952728392188,"cycle":-0.0076318549908967,"orig":4.3443208734012915,"zero":0},
{"x":120,"trend":4.3616207642188805,"cycle":-0.01091324272513288,"orig":4.350707521493748,"zero":0},
{"x":121,"trend":4.359129659864739,"cycle":-0.006838267997122875,"orig":4.352291391867616,"zero":0},
{"x":122,"trend":4.376576264868866,"cycle":-0.012417056201653802,"orig":4.364159208667212,"zero":0},
{"x":123,"trend":4.385141722695335,"cycle":-0.014656433868012205,"orig":4.3704852888273225,"zero":0},
{"x":124,"trend":4.380100125224569,"cycle":-0.008443321881878192,"orig":4.371656803342691,"zero":0},
{"x":125,"trend":4.384168443869992,"cycle":-0.00698727954973424,"orig":4.377181164320258,"zero":0},
{"x":126,"trend":4.388988509670036,"cycle":-0.007221908802014852,"orig":4.381766600868022,"zero":0},
{"x":127,"trend":4.400986159383985,"cycle":-0.01071361585625248,"orig":4.3902725435277326,"zero":0},
{"x":128,"trend":4.4159695231180915,"cycle":-0.015742033496773764,"orig":4.400227489621318,"zero":0},
{"x":129,"trend":4.427648306903745,"cycle":-0.018303241825852877,"orig":4.409345065077892,"zero":0},
{"x":130,"trend":4.437214256358586,"cycle":-0.019041341298697993,"orig":4.418172915059888,"zero":0},
{"x":131,"trend":4.444381825138399,"cycle":-0.018364621183483008,"orig":4.426017203954916,"zero":0},
{"x":132,"trend":4.444361706213341,"cycle":-0.014095058675508577,"orig":4.430266647537833,"zero":0},
{"x":133,"trend":4.444946917879836,"cycle":-0.010306486066057104,"orig":4.434640431813779,"zero":0},
{"x":134,"trend":4.441907362156897,"cycle":-0.005649440724849382,"orig":4.4362579214320474,"zero":0},
{"x":135,"trend":4.437291338978147,"cycle":-0.0006818265339741406,"orig":4.436609512444173,"zero":0},
{"x":136,"trend":4.440426318027269,"cycle":-0.00039142240248267115,"orig":4.440034895624787,"zero":0},
{"x":137,"trend":4.451233329555619,"cycle":-0.004628721397420079,"orig":4.446604608158198,"zero":0},
{"x":138,"trend":4.43677042292648,"cycle":0.0038175299455733562,"orig":4.440587952872053,"zero":0},
{"x":139,"trend":4.424845098666958,"cycle":0.01188986751158201,"orig":4.436734966178539,"zero":0},
{"x":140,"trend":4.465396039889024,"cycle":-0.008169172652207289,"orig":4.457226867236817,"zero":0},
{"x":141,"trend":4.466256837463705,"cycle":-0.009562298141849205,"orig":4.456694539321856,"zero":0},
{"x":142,"trend":4.471588928653588,"cycle":-0.008081390236880927,"orig":4.4635075384167076,"zero":0},
{"x":143,"trend":4.46598217568321,"cycle":-0.0032330644310343856,"orig":4.462749111252175,"zero":0},
{"x":144,"trend":4.469607637461865,"cycle":-0.002338376616239887,"orig":4.467269260845626,"zero":0},
{"x":145,"trend":4.4755722235770685,"cycle":-0.00399171762646452,"orig":4.471580505950604,"zero":0},
{"x":146,"trend":4.484128502510564,"cycle":-0.006484916909611988,"orig":4.477643585600952,"zero":0},
{"x":147,"trend":4.48486129707632,"cycle":-0.004951658785923061,"orig":4.479909638290398,"zero":0},
{"x":148,"trend":4.484671667354541,"cycle":-0.0024660429726369626,"orig":4.482205624381904,"zero":0},
{"x":149,"trend":4.493503667488374,"cycle":-0.00499539584808539,"orig":4.488508271640289,"zero":0},
{"x":150,"trend":4.489031891776588,"cycle":-0.001308298048307283,"orig":4.487723593728281,"zero":0},
{"x":151,"trend":4.495981030483712,"cycle":-0.002487934437419904,"orig":4.493493096046292,"zero":0},
{"x":152,"trend":4.5018338005386225,"cycle":-0.004333461328705702,"orig":4.497500339209917,"zero":0},
{"x":153,"trend":4.490242657166184,"cycle":0.00321242099828064,"orig":4.493455078164464,"zero":0},
{"x":154,"trend":4.510347302511221,"cycle":-0.004743340447957764,"orig":4.5056039620632635,"zero":0},
{"x":155,"trend":4.519622729156051,"cycle":-0.00918309099136302,"orig":4.510439638164688,"zero":0},
{"x":156,"trend":4.52921798357475,"cycle":-0.011094811574914844,"orig":4.518123171999835,"zero":0},
{"x":157,"trend":4.521418230702115,"cycle":-0.004664044087593726,"orig":4.516754186614521,"zero":0},
{"x":158,"trend":4.521364477520337,"cycle":-0.0014918651948253399,"orig":4.5198726123255115,"zero":0},
{"x":159,"trend":4.525598741758584,"cycle":-0.0021767169033930778,"orig":4.523422024855191,"zero":0},
{"x":160,"trend":4.534395809962099,"cycle":-0.0050392036958608905,"orig":4.529356606266238,"zero":0},
{"x":161,"trend":4.536593833147904,"cycle":-0.004533194828259888,"orig":4.532060638319645,"zero":0},
{"x":162,"trend":4.5330468181578665,"cycle":-0.0005957231118393671,"orig":4.532451095046027,"zero":0},
{"x":163,"trend":4.525673998758752,"cycle":0.004824363833686426,"orig":4.530498362592438,"zero":0},
{"x":164,"trend":4.518223605710332,"cycle":0.009548123489351145,"orig":4.527771729199683,"zero":0},
{"x":165,"trend":4.526992715943002,"cycle":0.005383096281562544,"orig":4.532375812224564,"zero":0},
{"x":166,"trend":4.5204127293893785,"cycle":0.008069698117478525,"orig":4.528482427506857,"zero":0},
{"x":167,"trend":4.519493071403784,"cycle":0.009268960577918038,"orig":4.528762031981702,"zero":0},
{"x":168,"trend":4.514002817500156,"cycle":0.01149084376123877,"orig":4.525493661261395,"zero":0},
{"x":169,"trend":4.505005575893666,"cycle":0.015717216016805566,"orig":4.5207227919104715,"zero":0},
{"x":170,"trend":4.493812252974747,"cycle":0.02037577380135417,"orig":4.514188026776101,"zero":0},
{"x":171,"trend":4.4927745854976795,"cycle":0.01936102952317974,"orig":4.512135615020859,"zero":0},
{"x":172,"trend":4.490226431178724,"cycle":0.01831280316979666,"orig":4.50853923434852,"zero":0},
{"x":173,"trend":4.484174527057049,"cycle":0.0195773625058402,"orig":4.503751889562889,"zero":0},
{"x":174,"trend":4.477177885625065,"cycle":0.021279760020486642,"orig":4.498457645645551,"zero":0},
{"x":175,"trend":4.468515102546741,"cycle":0.02351773982735773,"orig":4.4920328423740985,"zero":0},
{"x":176,"trend":4.4707402833802945,"cycle":0.020144119428713043,"orig":4.490884402809008,"zero":0},
{"x":177,"trend":4.466041182735842,"cycle":0.019765344068401493,"orig":4.485806526804244,"zero":0},
{"x":178,"trend":4.464008961954886,"cycle":0.019052345395015925,"orig":4.483061307349902,"zero":0},
{"x":179,"trend":4.456162272646139,"cycle":0.020833574618443654,"orig":4.476995847264583,"zero":0},
{"x":180,"trend":4.458734080247897,"cycle":0.017834257209285272,"orig":4.4765683374571825,"zero":0},
{"x":181,"trend":4.4763013605568585,"cycle":0.006900041741494471,"orig":4.483201402298353,"zero":0},
{"x":182,"trend":4.479189513180447,"cycle":0.0041271138005148185,"orig":4.483316626980963,"zero":0},
{"x":183,"trend":4.4918601089640795,"cycle":-0.0013311492881939346,"orig":4.490528959675886,"zero":0},
{"x":184,"trend":4.500578752412842,"cycle":-0.005178790571277921,"orig":4.4953999618415645,"zero":0},
{"x":185,"trend":4.504806042387516,"cycle":-0.005396452078590343,"orig":4.499409590308925,"zero":0},
{"x":186,"trend":4.516812671115731,"cycle":-0.00918806157035763,"orig":4.507624609545373,"zero":0},
{"x":187,"trend":4.5121781207782625,"cycle":-0.0048754818723889615,"orig":4.507302638905873,"zero":0},
{"x":188,"trend":4.50418336350241,"cycle":0.0020081218798996664,"orig":4.50619148538231,"zero":0},
{"x":189,"trend":4.502839815545091,"cycle":0.004200318533817607,"orig":4.507040134078909,"zero":0},
{"x":190,"trend":4.497606241049553,"cycle":0.007349056692421023,"orig":4.504955297741974,"zero":0},
{"x":191,"trend":4.507583062038411,"cycle":0.0029588116208812834,"orig":4.510541873659292,"zero":0},
{"x":192,"trend":4.497022295766517,"cycle":0.007942950601856166,"orig":4.504965246368373,"zero":0},
{"x":193,"trend":4.511417442401139,"cycle":0.0020332096911337832,"orig":4.513450652092272,"zero":0},
{"x":194,"trend":4.515004818834223,"cycle":-0.0003667458140238987,"orig":4.514638073020199,"zero":0},
{"x":195,"trend":4.506755849061297,"cycle":0.005250252611273928,"orig":4.512006101672571,"zero":0},
{"x":196,"trend":4.492818998799727,"cycle":0.013212387563757897,"orig":4.506031386363485,"zero":0},
{"x":197,"trend":4.492245985931346,"cycle":0.01351262100133006,"orig":4.505758606932676,"zero":0},
{"x":198,"trend":4.497382500314747,"cycle":0.009653221329480268,"orig":4.507035721644227,"zero":0},
{"x":199,"trend":4.508998035297926,"cycle":0.00316282189689911,"orig":4.512160857194826,"zero":0},
{"x":200,"trend":4.504990079181213,"cycle":0.00498662019363816,"orig":4.509976699374851,"zero":0},
{"x":201,"trend":4.515491736946731,"cycle":0.0009117141302591468,"orig":4.51640345107699,"zero":0},
{"x":202,"trend":4.517738451156587,"cycle":-0.00010414332117927638,"orig":4.517634307835408,"zero":0},
{"x":203,"trend":4.527925920527245,"cycle":-0.003609020642640297,"orig":4.524316899884605,"zero":0},
{"x":204,"trend":4.526379963868535,"cycle":-0.0017671179545197982,"orig":4.524612845914015,"zero":0},
{"x":205,"trend":4.525251839373189,"cycle":0.0008816327598599968,"orig":4.526133472133049,"zero":0},
{"x":206,"trend":4.534706307161121,"cycle":-0.0025585289189114955,"orig":4.5321477782422095,"zero":0},
{"x":207,"trend":4.524889132174978,"cycle":0.0032498902184638656,"orig":4.528139022393441,"zero":0},
{"x":208,"trend":4.528445367332216,"cycle":0.003401154237032676,"orig":4.531846521569248,"zero":0},
{"x":209,"trend":4.5423473621347,"cycle":-0.0033030898587151592,"orig":4.539044272275985,"zero":0},
{"x":210,"trend":4.525202127782122,"cycle":0.006009305687674692,"orig":4.531211433469797,"zero":0},
{"x":211,"trend":4.535666002167367,"cycle":0.0029893109860964686,"orig":4.5386553131534635,"zero":0},
{"x":212,"trend":4.538214902506018,"cycle":0.0011113773668136448,"orig":4.5393262798728315,"zero":0},
{"x":213,"trend":4.538078843575117,"cycle":0.002517620655869332,"orig":4.540596464230986,"zero":0},
{"x":214,"trend":4.55304479185955,"cycle":-0.003953014891330651,"orig":4.549091776968219,"zero":0},
{"x":215,"trend":4.556435821209398,"cycle":-0.004863688790184344,"orig":4.5515721324192135,"zero":0},
{"x":216,"trend":4.567460836361379,"cycle":-0.007952462941229713,"orig":4.559508373420149,"zero":0},
{"x":217,"trend":4.570952961416312,"cycle":-0.007854508880292871,"orig":4.563098452536019,"zero":0},
{"x":218,"trend":4.579718988694302,"cycle":-0.00938769009551207,"orig":4.5703312985987905,"zero":0},
{"x":219,"trend":4.572533988606047,"cycle":-0.0035548697868736812,"orig":4.568979118819173,"zero":0},
{"x":220,"trend":4.571093533422568,"cycle":3.5780840427802275e-5,"orig":4.571129314262995,"zero":0},
{"x":221,"trend":4.570393062777643,"cycle":0.0016359720122040991,"orig":4.572029034789847,"zero":0},
{"x":222,"trend":4.576918523796375,"cycle":-0.00040195984906461616,"orig":4.576516563947311,"zero":0},
{"x":223,"trend":4.5690565580950295,"cycle":0.004288539564064088,"orig":4.573345097659094,"zero":0},
{"x":224,"trend":4.572568200922522,"cycle":0.004030685083134317,"orig":4.576598886005656,"zero":0},
{"x":225,"trend":4.533988445693118,"cycle":0.02304661154299225,"orig":4.55703505723611,"zero":0},
{"x":226,"trend":4.556128023232507,"cycle":0.012971363410813331,"orig":4.5690993866433205,"zero":0},
{"x":227,"trend":4.585933309989141,"cycle":-0.005656406724325241,"orig":4.580276903264815,"zero":0},
{"x":228,"trend":4.594980910378746,"cycle":-0.009552313549699395,"orig":4.585428596829047,"zero":0},
{"x":229,"trend":4.592551127732547,"cycle":-0.005545930702583972,"orig":4.587005197029963,"zero":0},
{"x":230,"trend":4.588101691398741,"cycle":-0.0006749941884402577,"orig":4.587426697210301,"zero":0},
{"x":231,"trend":4.588966089995617,"cycle":0.0007127218744292901,"orig":4.589678811870047,"zero":0},
{"x":232,"trend":4.592809377635749,"cycle":-9.8487322431865e-5,"orig":4.592710890313318,"zero":0},
{"x":233,"trend":4.591170171790915,"cycle":0.0017948330788141653,"orig":4.592965004869729,"zero":0},
{"x":234,"trend":4.594877224711399,"cycle":0.0012491893747543733,"orig":4.596126414086154,"zero":0},
{"x":235,"trend":4.5924059413545075,"cycle":0.0032077262261141362,"orig":4.595613667580622,"zero":0},
{"x":236,"trend":4.5988119178468585,"cycle":0.0011808886120973716,"orig":4.599992806458956,"zero":0},
{"x":237,"trend":4.594589748663327,"cycle":0.0037400954386894386,"orig":4.598329844102016,"zero":0},
{"x":238,"trend":4.589873427244089,"cycle":0.007308940901800683,"orig":4.59718236814589,"zero":0},
{"x":239,"trend":4.588447593168413,"cycle":0.00831434234913949,"orig":4.596761935517553,"zero":0},
{"x":240,"trend":4.608552025032732,"cycle":-0.0016483424184895433,"orig":4.606903682614242,"zero":0},
{"x":241,"trend":4.6021988262058615,"cycle":0.0013159904140646703,"orig":4.603514816619926,"zero":0},
{"x":242,"trend":4.616284216031514,"cycle":-0.003390930103913502,"orig":4.6128932859276,"zero":0},
{"x":243,"trend":4.618945599683347,"cycle":-0.004273698306442933,"orig":4.614671901376903,"zero":0},
{"x":244,"trend":4.627501876304644,"cycle":-0.006129655025987486,"orig":4.621372221278656,"zero":0},
{"x":245,"trend":4.626106244367789,"cycle":-0.0037781016143232328,"orig":4.622328142753466,"zero":0},
{"x":246,"trend":4.622496142545451,"cycle":0.0004088479917230452,"orig":4.622904990537174,"zero":0},
{"x":247,"trend":4.617143958573599,"cycle":0.004560775253582486,"orig":4.6217047338271815,"zero":0},
{"x":248,"trend":4.619041953174365,"cycle":0.004586820037664747,"orig":4.6236287732120305,"zero":0},
{"x":249,"trend":4.6229184293978225,"cycle":0.0029304705986262524,"orig":4.625848899996448,"zero":0},
{"x":250,"trend":4.616259378905546,"cycle":0.0067654598763872125,"orig":4.623024838781934,"zero":0},
{"x":251,"trend":4.625119096561394,"cycle":0.00322645401725351,"orig":4.628345550578648,"zero":0},
{"x":252,"trend":4.626202478597926,"cycle":0.0024918326870350554,"orig":4.628694311284961,"zero":0}];
    const series = [{"name":"Original","color":"#1f77b4","key":"orig","dash":""},{"name":"Trend","color":"#ff7f0e","key":"trend","dash":"6,3"}];
    const bands = [];
    const refLines = [];

    const container = d3.select('#filt_tc_65');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Period') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Period');
    if('Value') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Value');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"trend":4.026925451723441,"cycle":0.0,"orig":4.026925451723441,"zero":0},
{"x":2,"trend":4.050293429153814,"cycle":-0.010273065662313036,"orig":4.040020363491501,"zero":0},
{"x":3,"trend":4.050123723345808,"cycle":-0.008656165057808966,"orig":4.041467558288,"zero":0},
{"x":4,"trend":4.055164707268839,"cycle":-0.007386034749702814,"orig":4.047778672519136,"zero":0},
{"x":5,"trend":4.063069057719749,"cycle":-0.008987618437944236,"orig":4.054081439281805,"zero":0},
{"x":6,"trend":4.068059945974408,"cycle":-0.008812477389769363,"orig":4.059247468584639,"zero":0},
{"x":7,"trend":4.075905179763181,"cycle":-0.009860645704575685,"orig":4.066044534058605,"zero":0},
{"x":8,"trend":4.0853887563915965,"cycle":-0.011866140795153373,"orig":4.073522615596443,"zero":0},
{"x":9,"trend":4.087338527900795,"cycle":-0.009884138291445334,"orig":4.07745438960935,"zero":0},
{"x":10,"trend":4.106935261732011,"cycle":-0.016247377013454495,"orig":4.090687884718557,"zero":0},
{"x":11,"trend":4.111338095245006,"cycle":-0.01578426448292046,"orig":4.095553830762086,"zero":0},
{"x":12,"trend":4.113697745846823,"cycle":-0.012551368505794153,"orig":4.101146377341029,"zero":0},
{"x":13,"trend":4.106508703400528,"cycle":-0.005559334348556679,"orig":4.100949369051971,"zero":0},
{"x":14,"trend":4.11017932928215,"cycle":-0.004230688889536696,"orig":4.105948640392613,"zero":0},
{"x":15,"trend":4.111797697540901,"cycle":-0.003384234723341053,"orig":4.10841346281756,"zero":0},
{"x":16,"trend":4.119212761656242,"cycle":-0.005014919826040346,"orig":4.114197841830202,"zero":0},
{"x":17,"trend":4.112035483455546,"cycle":0.00014408529146769044,"orig":4.112179568747014,"zero":0},
{"x":18,"trend":4.1134243244460125,"cycle":0.0016521716951689825,"orig":4.115076496141182,"zero":0},
{"x":19,"trend":4.112286933198099,"cycle":0.0029364743753404897,"orig":4.11522340757344,"zero":0},
{"x":20,"trend":4.120060202036571,"cycle":0.000164884815105972,"orig":4.120225086851677,"zero":0},
{"x":21,"trend":4.112748353643083,"cycle":0.004347099849721772,"orig":4.117095453492804,"zero":0},
{"x":22,"trend":4.118347566249533,"cycle":0.0030494236338843555,"orig":4.121396989883417,"zero":0},
{"x":23,"trend":4.1229453928062325,"cycle":0.0008673526649046723,"orig":4.123812745471137,"zero":0},
{"x":24,"trend":4.129842802514594,"cycle":-0.0015107478653802581,"orig":4.128332054649214,"zero":0},
{"x":25,"trend":4.133494130890621,"cycle":-0.002216727108928283,"orig":4.131277403781692,"zero":0},
{"x":26,"trend":4.121628635948565,"cycle":0.005213770991196665,"orig":4.126842406939762,"zero":0},
{"x":27,"trend":4.123512550777935,"cycle":0.005827464591408121,"orig":4.129340015369343,"zero":0},
{"x":28,"trend":4.123551395462443,"cycle":0.005638939185255698,"orig":4.129190334647699,"zero":0},
{"x":29,"trend":4.11142604958097,"cycle":0.01206298957959913,"orig":4.123489039160569,"zero":0},
{"x":30,"trend":4.110831244317112,"cycle":0.012581708652335294,"orig":4.123412952969447,"zero":0},
{"x":31,"trend":4.094075269469823,"cycle":0.019643723810368913,"orig":4.113718993280192,"zero":0},
{"x":32,"trend":4.114485100504465,"cycle":0.008984512944879171,"orig":4.123469613449345,"zero":0},
{"x":33,"trend":4.113315412656833,"cycle":0.007015234202964527,"orig":4.120330646859798,"zero":0},
{"x":34,"trend":4.109047366960234,"cycle":0.009934521771145533,"orig":4.11898188873138,"zero":0},
{"x":35,"trend":4.116185427661352,"cycle":0.0061698135112423025,"orig":4.1223552411725946,"zero":0},
{"x":36,"trend":4.127810446697464,"cycle":1.4022765239757819e-5,"orig":4.127824469462704,"zero":0},
{"x":37,"trend":4.1168427066240705,"cycle":0.005911130071707858,"orig":4.122753836695779,"zero":0},
{"x":38,"trend":4.131622020074845,"cycle":0.0001724575940930011,"orig":4.131794477668938,"zero":0},
{"x":39,"trend":4.142031854985796,"cycle":-0.0052681743251091805,"orig":4.136763680660687,"zero":0},
{"x":40,"trend":4.133232107749383,"cycle":0.0009083227054212178,"orig":4.134140430454805,"zero":0},
{"x":41,"trend":4.135012916258892,"cycle":0.0021644175156418973,"orig":4.137177333774534,"zero":0},
{"x":42,"trend":4.1405632902220715,"cycle":-1.2142058758049756e-7,"orig":4.140563168801484,"zero":0},
{"x":43,"trend":4.1351911516970485,"cycle":0.00362314394890196,"orig":4.13881429564595,"zero":0},
{"x":44,"trend":4.139486211961466,"cycle":0.002814833681488675,"orig":4.142301045642955,"zero":0},
{"x":45,"trend":4.139032737354952,"cycle":0.003344559402021386,"orig":4.142377296756973,"zero":0},
{"x":46,"trend":4.125649858116745,"cycle":0.010867785496551385,"orig":4.136517643613296,"zero":0},
{"x":47,"trend":4.099452281574726,"cycle":0.024268218273764755,"orig":4.12372049984849,"zero":0},
{"x":48,"trend":4.086981637124664,"cycle":0.02937226613569284,"orig":4.116353903260356,"zero":0},
{"x":49,"trend":4.087319317974917,"cycle":0.02577339420887579,"orig":4.113092712183793,"zero":0},
{"x":50,"trend":4.079667963081323,"cycle":0.026008813037442204,"orig":4.105676776118765,"zero":0},
{"x":51,"trend":4.073513808434579,"cycle":0.026391928417894193,"orig":4.099905736852473,"zero":0},
{"x":52,"trend":4.084776802204413,"cycle":0.01776407824217369,"orig":4.102540880446586,"zero":0},
{"x":53,"trend":4.109046106632173,"cycle":0.002864924415611361,"orig":4.111911031047784,"zero":0},
{"x":54,"trend":4.126926942824802,"cycle":-0.006945498527964065,"orig":4.1199814442968385,"zero":0},
{"x":55,"trend":4.129381031062395,"cycle":-0.006602894899987851,"orig":4.122778136162407,"zero":0},
{"x":56,"trend":4.124138297854866,"cycle":-0.0013715013700722075,"orig":4.122766796484794,"zero":0},
{"x":57,"trend":4.13558957426972,"cycle":-0.004921118833803362,"orig":4.1306684554359165,"zero":0},
{"x":58,"trend":4.132328265738153,"cycle":-0.0022064121405310122,"orig":4.130121853597622,"zero":0},
{"x":59,"trend":4.124527751808625,"cycle":0.004010486083454039,"orig":4.128538237892079,"zero":0},
{"x":60,"trend":4.1126494675656415,"cycle":0.011014386016915016,"orig":4.123663853582556,"zero":0},
{"x":61,"trend":4.101778522819304,"cycle":0.016634066736497116,"orig":4.118412589555801,"zero":0},
{"x":62,"trend":4.117447389534317,"cycle":0.008000089613774172,"orig":4.125447479148091,"zero":0},
{"x":63,"trend":4.137467226042511,"cycle":-0.0035302248939207874,"orig":4.13393700114859,"zero":0},
{"x":64,"trend":4.15103026654486,"cycle":-0.009531798729473323,"orig":4.141498467815387,"zero":0},
{"x":65,"trend":4.153035315232785,"cycle":-0.008251156252614586,"orig":4.14478415898017,"zero":0},
{"x":66,"trend":4.148282256405679,"cycle":-0.002986374929525887,"orig":4.145295881476153,"zero":0},
{"x":67,"trend":4.16170762637194,"cycle":-0.007246806822854898,"orig":4.154460819549085,"zero":0},
{"x":68,"trend":4.14800018318845,"cycle":0.0008530817840041498,"orig":4.148853264972454,"zero":0},
{"x":69,"trend":4.148936446746004,"cycle":0.0032099333983513774,"orig":4.152146380144355,"zero":0},
{"x":70,"trend":4.16164621045001,"cycle":-0.0027709396208560576,"orig":4.158875270829154,"zero":0},
{"x":71,"trend":4.167358225476887,"cycle":-0.004697909849438554,"orig":4.162660315627448,"zero":0},
{"x":72,"trend":4.16676282207845,"cycle":-0.002415010084601223,"orig":4.164347811993848,"zero":0},
{"x":73,"trend":4.170496328008808,"cycle":-0.002315973527714617,"orig":4.168180354481093,"zero":0},
{"x":74,"trend":4.177135078087011,"cycle":-0.00415032972659328,"orig":4.172984748360418,"zero":0},
{"x":75,"trend":4.172210737147006,"cycle":-9.990251895696995e-5,"orig":4.172110834628049,"zero":0},
{"x":76,"trend":4.173721384023903,"cycle":0.001128855607782539,"orig":4.174850239631685,"zero":0},
{"x":77,"trend":4.164567201967288,"cycle":0.006491457322517293,"orig":4.171058659289805,"zero":0},
{"x":78,"trend":4.166845877276167,"cycle":0.006465429363172443,"orig":4.173311306639339,"zero":0},
{"x":79,"trend":4.172657161191993,"cycle":0.0033472619446587642,"orig":4.176004423136652,"zero":0},
{"x":80,"trend":4.169576087274936,"cycle":0.0052218675088853885,"orig":4.174797954783822,"zero":0},
{"x":81,"trend":4.1783887901770305,"cycle":0.0017006529225263654,"orig":4.180089443099557,"zero":0},
{"x":82,"trend":4.1924224729971895,"cycle":-0.0050293774753299705,"orig":4.18739309552186,"zero":0},
{"x":83,"trend":4.1988756759512516,"cycle":-0.006923574876142737,"orig":4.191952101075109,"zero":0},
{"x":84,"trend":4.205889584431758,"cycle":-0.008032212509619876,"orig":4.197857371922138,"zero":0},
{"x":85,"trend":4.20703765670014,"cycle":-0.006306605311073451,"orig":4.2007310513890666,"zero":0},
{"x":86,"trend":4.20313166725918,"cycle":-0.0018178840398370836,"orig":4.2013137832193435,"zero":0},
{"x":87,"trend":4.219058233911237,"cycle":-0.007594560085261961,"orig":4.211463673825975,"zero":0},
{"x":88,"trend":4.22822535955033,"cycle":-0.010865547681702193,"orig":4.2173598118686275,"zero":0},
{"x":89,"trend":4.231444689575091,"cycle":-0.00949438174791637,"orig":4.221950307827175,"zero":0},
{"x":90,"trend":4.23891264135376,"cycle":-0.01023388383944912,"orig":4.228678757514311,"zero":0},
{"x":91,"trend":4.2363844039678185,"cycle":-0.00637614077400846,"orig":4.23000826319381,"zero":0},
{"x":92,"trend":4.24374283142308,"cycle":-0.007052710716343284,"orig":4.2366901207067365,"zero":0},
{"x":93,"trend":4.2462077901232265,"cycle":-0.006377120154937941,"orig":4.239830669968288,"zero":0},
{"x":94,"trend":4.256983251752158,"cycle":-0.009139650546011407,"orig":4.247843601206147,"zero":0},
{"x":95,"trend":4.266296046445312,"cycle":-0.011639822282480299,"orig":4.254656224162832,"zero":0},
{"x":96,"trend":4.280520192908697,"cycle":-0.01569754282363219,"orig":4.264822650085065,"zero":0},
{"x":97,"trend":4.277743506208359,"cycle":-0.011220319925356527,"orig":4.266523186283003,"zero":0},
{"x":98,"trend":4.267706171367561,"cycle":-0.002311672389569901,"orig":4.265394498977991,"zero":0},
{"x":99,"trend":4.265971604826933,"cycle":0.0010831953093454686,"orig":4.267054800136278,"zero":0},
{"x":100,"trend":4.260372284173425,"cycle":0.004954790172636852,"orig":4.265327074346062,"zero":0},
{"x":101,"trend":4.268060492131199,"cycle":0.0021654891999815895,"orig":4.270225981331181,"zero":0},
{"x":102,"trend":4.274285808187028,"cycle":-0.0007509754236442286,"orig":4.273534832763384,"zero":0},
{"x":103,"trend":4.263741041559056,"cycle":0.005603898464222042,"orig":4.269344940023278,"zero":0},
{"x":104,"trend":4.286880884589572,"cycle":-0.004366621573842939,"orig":4.282514263015729,"zero":0},
{"x":105,"trend":4.295189018172737,"cycle":-0.008649578969528436,"orig":4.286539439203208,"zero":0},
{"x":106,"trend":4.286120682100366,"cycle":-0.0013403503080635687,"orig":4.2847803317923026,"zero":0},
{"x":107,"trend":4.286460092590057,"cycle":0.0009522450968779447,"orig":4.287412337686935,"zero":0},
{"x":108,"trend":4.2914314929837705,"cycle":-0.0005543308737513915,"orig":4.290877162110019,"zero":0},
{"x":109,"trend":4.278000798648018,"cycle":0.007136284670632839,"orig":4.285137083318651,"zero":0},
{"x":110,"trend":4.303826182917794,"cycle":-0.004159939672677184,"orig":4.299666243245117,"zero":0},
{"x":111,"trend":4.302518513675276,"cycle":-0.004077313059199741,"orig":4.298441200616076,"zero":0},
{"x":112,"trend":4.316120881366241,"cycle":-0.007778462489644297,"orig":4.308342418876597,"zero":0},
{"x":113,"trend":4.328137221681117,"cycle":-0.012349219181595554,"orig":4.315788002499521,"zero":0},
{"x":114,"trend":4.33726284572901,"cycle":-0.013881464988304937,"orig":4.323381380740705,"zero":0},
{"x":115,"trend":4.3311385566871605,"cycle":-0.007603429910745422,"orig":4.323535126776415,"zero":0},
{"x":116,"trend":4.334316915998395,"cycle":-0.005676553937404373,"orig":4.32864036206099,"zero":0},
{"x":117,"trend":4.342800644778063,"cycle":-0.00792065059885852,"orig":4.334879994179205,"zero":0},
{"x":118,"trend":4.339084753451595,"cycle":-0.003908665222372032,"orig":4.335176088229223,"zero":0},
{"x":119,"trend":4.351952728392188,"cycle":-0.0076318549908967,"orig":4.3443208734012915,"zero":0},
{"x":120,"trend":4.3616207642188805,"cycle":-0.01091324272513288,"orig":4.350707521493748,"zero":0},
{"x":121,"trend":4.359129659864739,"cycle":-0.006838267997122875,"orig":4.352291391867616,"zero":0},
{"x":122,"trend":4.376576264868866,"cycle":-0.012417056201653802,"orig":4.364159208667212,"zero":0},
{"x":123,"trend":4.385141722695335,"cycle":-0.014656433868012205,"orig":4.3704852888273225,"zero":0},
{"x":124,"trend":4.380100125224569,"cycle":-0.008443321881878192,"orig":4.371656803342691,"zero":0},
{"x":125,"trend":4.384168443869992,"cycle":-0.00698727954973424,"orig":4.377181164320258,"zero":0},
{"x":126,"trend":4.388988509670036,"cycle":-0.007221908802014852,"orig":4.381766600868022,"zero":0},
{"x":127,"trend":4.400986159383985,"cycle":-0.01071361585625248,"orig":4.3902725435277326,"zero":0},
{"x":128,"trend":4.4159695231180915,"cycle":-0.015742033496773764,"orig":4.400227489621318,"zero":0},
{"x":129,"trend":4.427648306903745,"cycle":-0.018303241825852877,"orig":4.409345065077892,"zero":0},
{"x":130,"trend":4.437214256358586,"cycle":-0.019041341298697993,"orig":4.418172915059888,"zero":0},
{"x":131,"trend":4.444381825138399,"cycle":-0.018364621183483008,"orig":4.426017203954916,"zero":0},
{"x":132,"trend":4.444361706213341,"cycle":-0.014095058675508577,"orig":4.430266647537833,"zero":0},
{"x":133,"trend":4.444946917879836,"cycle":-0.010306486066057104,"orig":4.434640431813779,"zero":0},
{"x":134,"trend":4.441907362156897,"cycle":-0.005649440724849382,"orig":4.4362579214320474,"zero":0},
{"x":135,"trend":4.437291338978147,"cycle":-0.0006818265339741406,"orig":4.436609512444173,"zero":0},
{"x":136,"trend":4.440426318027269,"cycle":-0.00039142240248267115,"orig":4.440034895624787,"zero":0},
{"x":137,"trend":4.451233329555619,"cycle":-0.004628721397420079,"orig":4.446604608158198,"zero":0},
{"x":138,"trend":4.43677042292648,"cycle":0.0038175299455733562,"orig":4.440587952872053,"zero":0},
{"x":139,"trend":4.424845098666958,"cycle":0.01188986751158201,"orig":4.436734966178539,"zero":0},
{"x":140,"trend":4.465396039889024,"cycle":-0.008169172652207289,"orig":4.457226867236817,"zero":0},
{"x":141,"trend":4.466256837463705,"cycle":-0.009562298141849205,"orig":4.456694539321856,"zero":0},
{"x":142,"trend":4.471588928653588,"cycle":-0.008081390236880927,"orig":4.4635075384167076,"zero":0},
{"x":143,"trend":4.46598217568321,"cycle":-0.0032330644310343856,"orig":4.462749111252175,"zero":0},
{"x":144,"trend":4.469607637461865,"cycle":-0.002338376616239887,"orig":4.467269260845626,"zero":0},
{"x":145,"trend":4.4755722235770685,"cycle":-0.00399171762646452,"orig":4.471580505950604,"zero":0},
{"x":146,"trend":4.484128502510564,"cycle":-0.006484916909611988,"orig":4.477643585600952,"zero":0},
{"x":147,"trend":4.48486129707632,"cycle":-0.004951658785923061,"orig":4.479909638290398,"zero":0},
{"x":148,"trend":4.484671667354541,"cycle":-0.0024660429726369626,"orig":4.482205624381904,"zero":0},
{"x":149,"trend":4.493503667488374,"cycle":-0.00499539584808539,"orig":4.488508271640289,"zero":0},
{"x":150,"trend":4.489031891776588,"cycle":-0.001308298048307283,"orig":4.487723593728281,"zero":0},
{"x":151,"trend":4.495981030483712,"cycle":-0.002487934437419904,"orig":4.493493096046292,"zero":0},
{"x":152,"trend":4.5018338005386225,"cycle":-0.004333461328705702,"orig":4.497500339209917,"zero":0},
{"x":153,"trend":4.490242657166184,"cycle":0.00321242099828064,"orig":4.493455078164464,"zero":0},
{"x":154,"trend":4.510347302511221,"cycle":-0.004743340447957764,"orig":4.5056039620632635,"zero":0},
{"x":155,"trend":4.519622729156051,"cycle":-0.00918309099136302,"orig":4.510439638164688,"zero":0},
{"x":156,"trend":4.52921798357475,"cycle":-0.011094811574914844,"orig":4.518123171999835,"zero":0},
{"x":157,"trend":4.521418230702115,"cycle":-0.004664044087593726,"orig":4.516754186614521,"zero":0},
{"x":158,"trend":4.521364477520337,"cycle":-0.0014918651948253399,"orig":4.5198726123255115,"zero":0},
{"x":159,"trend":4.525598741758584,"cycle":-0.0021767169033930778,"orig":4.523422024855191,"zero":0},
{"x":160,"trend":4.534395809962099,"cycle":-0.0050392036958608905,"orig":4.529356606266238,"zero":0},
{"x":161,"trend":4.536593833147904,"cycle":-0.004533194828259888,"orig":4.532060638319645,"zero":0},
{"x":162,"trend":4.5330468181578665,"cycle":-0.0005957231118393671,"orig":4.532451095046027,"zero":0},
{"x":163,"trend":4.525673998758752,"cycle":0.004824363833686426,"orig":4.530498362592438,"zero":0},
{"x":164,"trend":4.518223605710332,"cycle":0.009548123489351145,"orig":4.527771729199683,"zero":0},
{"x":165,"trend":4.526992715943002,"cycle":0.005383096281562544,"orig":4.532375812224564,"zero":0},
{"x":166,"trend":4.5204127293893785,"cycle":0.008069698117478525,"orig":4.528482427506857,"zero":0},
{"x":167,"trend":4.519493071403784,"cycle":0.009268960577918038,"orig":4.528762031981702,"zero":0},
{"x":168,"trend":4.514002817500156,"cycle":0.01149084376123877,"orig":4.525493661261395,"zero":0},
{"x":169,"trend":4.505005575893666,"cycle":0.015717216016805566,"orig":4.5207227919104715,"zero":0},
{"x":170,"trend":4.493812252974747,"cycle":0.02037577380135417,"orig":4.514188026776101,"zero":0},
{"x":171,"trend":4.4927745854976795,"cycle":0.01936102952317974,"orig":4.512135615020859,"zero":0},
{"x":172,"trend":4.490226431178724,"cycle":0.01831280316979666,"orig":4.50853923434852,"zero":0},
{"x":173,"trend":4.484174527057049,"cycle":0.0195773625058402,"orig":4.503751889562889,"zero":0},
{"x":174,"trend":4.477177885625065,"cycle":0.021279760020486642,"orig":4.498457645645551,"zero":0},
{"x":175,"trend":4.468515102546741,"cycle":0.02351773982735773,"orig":4.4920328423740985,"zero":0},
{"x":176,"trend":4.4707402833802945,"cycle":0.020144119428713043,"orig":4.490884402809008,"zero":0},
{"x":177,"trend":4.466041182735842,"cycle":0.019765344068401493,"orig":4.485806526804244,"zero":0},
{"x":178,"trend":4.464008961954886,"cycle":0.019052345395015925,"orig":4.483061307349902,"zero":0},
{"x":179,"trend":4.456162272646139,"cycle":0.020833574618443654,"orig":4.476995847264583,"zero":0},
{"x":180,"trend":4.458734080247897,"cycle":0.017834257209285272,"orig":4.4765683374571825,"zero":0},
{"x":181,"trend":4.4763013605568585,"cycle":0.006900041741494471,"orig":4.483201402298353,"zero":0},
{"x":182,"trend":4.479189513180447,"cycle":0.0041271138005148185,"orig":4.483316626980963,"zero":0},
{"x":183,"trend":4.4918601089640795,"cycle":-0.0013311492881939346,"orig":4.490528959675886,"zero":0},
{"x":184,"trend":4.500578752412842,"cycle":-0.005178790571277921,"orig":4.4953999618415645,"zero":0},
{"x":185,"trend":4.504806042387516,"cycle":-0.005396452078590343,"orig":4.499409590308925,"zero":0},
{"x":186,"trend":4.516812671115731,"cycle":-0.00918806157035763,"orig":4.507624609545373,"zero":0},
{"x":187,"trend":4.5121781207782625,"cycle":-0.0048754818723889615,"orig":4.507302638905873,"zero":0},
{"x":188,"trend":4.50418336350241,"cycle":0.0020081218798996664,"orig":4.50619148538231,"zero":0},
{"x":189,"trend":4.502839815545091,"cycle":0.004200318533817607,"orig":4.507040134078909,"zero":0},
{"x":190,"trend":4.497606241049553,"cycle":0.007349056692421023,"orig":4.504955297741974,"zero":0},
{"x":191,"trend":4.507583062038411,"cycle":0.0029588116208812834,"orig":4.510541873659292,"zero":0},
{"x":192,"trend":4.497022295766517,"cycle":0.007942950601856166,"orig":4.504965246368373,"zero":0},
{"x":193,"trend":4.511417442401139,"cycle":0.0020332096911337832,"orig":4.513450652092272,"zero":0},
{"x":194,"trend":4.515004818834223,"cycle":-0.0003667458140238987,"orig":4.514638073020199,"zero":0},
{"x":195,"trend":4.506755849061297,"cycle":0.005250252611273928,"orig":4.512006101672571,"zero":0},
{"x":196,"trend":4.492818998799727,"cycle":0.013212387563757897,"orig":4.506031386363485,"zero":0},
{"x":197,"trend":4.492245985931346,"cycle":0.01351262100133006,"orig":4.505758606932676,"zero":0},
{"x":198,"trend":4.497382500314747,"cycle":0.009653221329480268,"orig":4.507035721644227,"zero":0},
{"x":199,"trend":4.508998035297926,"cycle":0.00316282189689911,"orig":4.512160857194826,"zero":0},
{"x":200,"trend":4.504990079181213,"cycle":0.00498662019363816,"orig":4.509976699374851,"zero":0},
{"x":201,"trend":4.515491736946731,"cycle":0.0009117141302591468,"orig":4.51640345107699,"zero":0},
{"x":202,"trend":4.517738451156587,"cycle":-0.00010414332117927638,"orig":4.517634307835408,"zero":0},
{"x":203,"trend":4.527925920527245,"cycle":-0.003609020642640297,"orig":4.524316899884605,"zero":0},
{"x":204,"trend":4.526379963868535,"cycle":-0.0017671179545197982,"orig":4.524612845914015,"zero":0},
{"x":205,"trend":4.525251839373189,"cycle":0.0008816327598599968,"orig":4.526133472133049,"zero":0},
{"x":206,"trend":4.534706307161121,"cycle":-0.0025585289189114955,"orig":4.5321477782422095,"zero":0},
{"x":207,"trend":4.524889132174978,"cycle":0.0032498902184638656,"orig":4.528139022393441,"zero":0},
{"x":208,"trend":4.528445367332216,"cycle":0.003401154237032676,"orig":4.531846521569248,"zero":0},
{"x":209,"trend":4.5423473621347,"cycle":-0.0033030898587151592,"orig":4.539044272275985,"zero":0},
{"x":210,"trend":4.525202127782122,"cycle":0.006009305687674692,"orig":4.531211433469797,"zero":0},
{"x":211,"trend":4.535666002167367,"cycle":0.0029893109860964686,"orig":4.5386553131534635,"zero":0},
{"x":212,"trend":4.538214902506018,"cycle":0.0011113773668136448,"orig":4.5393262798728315,"zero":0},
{"x":213,"trend":4.538078843575117,"cycle":0.002517620655869332,"orig":4.540596464230986,"zero":0},
{"x":214,"trend":4.55304479185955,"cycle":-0.003953014891330651,"orig":4.549091776968219,"zero":0},
{"x":215,"trend":4.556435821209398,"cycle":-0.004863688790184344,"orig":4.5515721324192135,"zero":0},
{"x":216,"trend":4.567460836361379,"cycle":-0.007952462941229713,"orig":4.559508373420149,"zero":0},
{"x":217,"trend":4.570952961416312,"cycle":-0.007854508880292871,"orig":4.563098452536019,"zero":0},
{"x":218,"trend":4.579718988694302,"cycle":-0.00938769009551207,"orig":4.5703312985987905,"zero":0},
{"x":219,"trend":4.572533988606047,"cycle":-0.0035548697868736812,"orig":4.568979118819173,"zero":0},
{"x":220,"trend":4.571093533422568,"cycle":3.5780840427802275e-5,"orig":4.571129314262995,"zero":0},
{"x":221,"trend":4.570393062777643,"cycle":0.0016359720122040991,"orig":4.572029034789847,"zero":0},
{"x":222,"trend":4.576918523796375,"cycle":-0.00040195984906461616,"orig":4.576516563947311,"zero":0},
{"x":223,"trend":4.5690565580950295,"cycle":0.004288539564064088,"orig":4.573345097659094,"zero":0},
{"x":224,"trend":4.572568200922522,"cycle":0.004030685083134317,"orig":4.576598886005656,"zero":0},
{"x":225,"trend":4.533988445693118,"cycle":0.02304661154299225,"orig":4.55703505723611,"zero":0},
{"x":226,"trend":4.556128023232507,"cycle":0.012971363410813331,"orig":4.5690993866433205,"zero":0},
{"x":227,"trend":4.585933309989141,"cycle":-0.005656406724325241,"orig":4.580276903264815,"zero":0},
{"x":228,"trend":4.594980910378746,"cycle":-0.009552313549699395,"orig":4.585428596829047,"zero":0},
{"x":229,"trend":4.592551127732547,"cycle":-0.005545930702583972,"orig":4.587005197029963,"zero":0},
{"x":230,"trend":4.588101691398741,"cycle":-0.0006749941884402577,"orig":4.587426697210301,"zero":0},
{"x":231,"trend":4.588966089995617,"cycle":0.0007127218744292901,"orig":4.589678811870047,"zero":0},
{"x":232,"trend":4.592809377635749,"cycle":-9.8487322431865e-5,"orig":4.592710890313318,"zero":0},
{"x":233,"trend":4.591170171790915,"cycle":0.0017948330788141653,"orig":4.592965004869729,"zero":0},
{"x":234,"trend":4.594877224711399,"cycle":0.0012491893747543733,"orig":4.596126414086154,"zero":0},
{"x":235,"trend":4.5924059413545075,"cycle":0.0032077262261141362,"orig":4.595613667580622,"zero":0},
{"x":236,"trend":4.5988119178468585,"cycle":0.0011808886120973716,"orig":4.599992806458956,"zero":0},
{"x":237,"trend":4.594589748663327,"cycle":0.0037400954386894386,"orig":4.598329844102016,"zero":0},
{"x":238,"trend":4.589873427244089,"cycle":0.007308940901800683,"orig":4.59718236814589,"zero":0},
{"x":239,"trend":4.588447593168413,"cycle":0.00831434234913949,"orig":4.596761935517553,"zero":0},
{"x":240,"trend":4.608552025032732,"cycle":-0.0016483424184895433,"orig":4.606903682614242,"zero":0},
{"x":241,"trend":4.6021988262058615,"cycle":0.0013159904140646703,"orig":4.603514816619926,"zero":0},
{"x":242,"trend":4.616284216031514,"cycle":-0.003390930103913502,"orig":4.6128932859276,"zero":0},
{"x":243,"trend":4.618945599683347,"cycle":-0.004273698306442933,"orig":4.614671901376903,"zero":0},
{"x":244,"trend":4.627501876304644,"cycle":-0.006129655025987486,"orig":4.621372221278656,"zero":0},
{"x":245,"trend":4.626106244367789,"cycle":-0.0037781016143232328,"orig":4.622328142753466,"zero":0},
{"x":246,"trend":4.622496142545451,"cycle":0.0004088479917230452,"orig":4.622904990537174,"zero":0},
{"x":247,"trend":4.617143958573599,"cycle":0.004560775253582486,"orig":4.6217047338271815,"zero":0},
{"x":248,"trend":4.619041953174365,"cycle":0.004586820037664747,"orig":4.6236287732120305,"zero":0},
{"x":249,"trend":4.6229184293978225,"cycle":0.0029304705986262524,"orig":4.625848899996448,"zero":0},
{"x":250,"trend":4.616259378905546,"cycle":0.0067654598763872125,"orig":4.623024838781934,"zero":0},
{"x":251,"trend":4.625119096561394,"cycle":0.00322645401725351,"orig":4.628345550578648,"zero":0},
{"x":252,"trend":4.626202478597926,"cycle":0.0024918326870350554,"orig":4.628694311284961,"zero":0}];
    const series = [{"name":"Cycle","color":"#2ca02c","key":"cycle","dash":""}];
    const bands = [];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#filt_cy_66');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Period') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Period');
    if('Cycle') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Cycle');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>