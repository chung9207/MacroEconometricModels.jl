<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LP Impulse Responses (newey_west, 95% CI)</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(33% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">LP Impulse Responses (newey_west, 95% CI)</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">Var 1 ← Shock 1</div>
<div id="lpirf_28"></div>
</div>
<div class="panel">
<div class="panel-title">Var 2 ← Shock 1</div>
<div id="lpirf_29"></div>
</div>
<div class="panel">
<div class="panel-title">Var 3 ← Shock 1</div>
<div id="lpirf_30"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":0,"irf":0.9999999999999999,"ci_lo":0.9999999999999999,"ci_hi":0.9999999999999999,"zero":0},
{"x":1,"irf":0.27888381031190174,"ci_lo":0.27231980889809304,"ci_hi":0.28544781172571043,"zero":0},
{"x":2,"irf":-0.010326361181564023,"ci_lo":-0.019177824995693076,"ci_hi":-0.0014748973674349707,"zero":0},
{"x":3,"irf":0.0403952231256954,"ci_lo":0.03313224102413445,"ci_hi":0.04765820522725635,"zero":0},
{"x":4,"irf":0.06760543674372671,"ci_lo":0.0631789002749948,"ci_hi":0.07203197321245862,"zero":0},
{"x":5,"irf":0.00011916438763312169,"ci_lo":-0.0031613388948222186,"ci_hi":0.0033996676700884616,"zero":0},
{"x":6,"irf":0.036573342584949056,"ci_lo":0.03364470980153994,"ci_hi":0.03950197536835817,"zero":0},
{"x":7,"irf":0.054053610541869336,"ci_lo":0.05114964129330298,"ci_hi":0.05695757979043569,"zero":0},
{"x":8,"irf":-0.011377083471041315,"ci_lo":-0.01390596227866028,"ci_hi":-0.00884820466342235,"zero":0},
{"x":9,"irf":0.01868566017762624,"ci_lo":0.015540022645271316,"ci_hi":0.021831297709981164,"zero":0},
{"x":10,"irf":0.12111217793118413,"ci_lo":0.11813406076085504,"ci_hi":0.12409029510151322,"zero":0},
{"x":11,"irf":-0.00936689192204626,"ci_lo":-0.012247544113465401,"ci_hi":-0.006486239730627117,"zero":0},
{"x":12,"irf":-0.034030178587671676,"ci_lo":-0.03640795846174826,"ci_hi":-0.03165239871359509,"zero":0},
{"x":13,"irf":-0.01780925156267741,"ci_lo":-0.019536230775515813,"ci_hi":-0.016082272349839007,"zero":0},
{"x":14,"irf":-0.02352671303664519,"ci_lo":-0.0253788075423455,"ci_hi":-0.02167461853094488,"zero":0},
{"x":15,"irf":-0.008553034965863234,"ci_lo":-0.010627543143656763,"ci_hi":-0.006478526788069705,"zero":0},
{"x":16,"irf":0.013116709057166354,"ci_lo":0.010899208787088218,"ci_hi":0.01533420932724449,"zero":0},
{"x":17,"irf":0.012659127061371563,"ci_lo":0.010190363351381916,"ci_hi":0.01512789077136121,"zero":0},
{"x":18,"irf":-0.005218251370335416,"ci_lo":-0.007379986181065633,"ci_hi":-0.0030565165596051994,"zero":0},
{"x":19,"irf":-0.019149310300062637,"ci_lo":-0.020846674973021718,"ci_hi":-0.017451945627103557,"zero":0},
{"x":20,"irf":-0.024310634747431153,"ci_lo":-0.02635530180153074,"ci_hi":-0.022265967693331567,"zero":0}];
    const series = [{"name":"LP-IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#lpirf_28');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":-26.71458886239615,"ci_lo":-27.577401342502682,"ci_hi":-25.851776382289614,"zero":0},
{"x":1,"irf":-9.655092455054405,"ci_lo":-9.875907244786431,"ci_hi":-9.434277665322378,"zero":0},
{"x":2,"irf":1.135324820797818,"ci_lo":0.7885621502829459,"ci_hi":1.48208749131269,"zero":0},
{"x":3,"irf":-2.0303738542125744,"ci_lo":-2.2455067614181914,"ci_hi":-1.8152409470069575,"zero":0},
{"x":4,"irf":-0.7202311582718038,"ci_lo":-0.9844370135219178,"ci_hi":-0.4560253030216898,"zero":0},
{"x":5,"irf":0.4751763340910441,"ci_lo":0.316684885057436,"ci_hi":0.6336677831246522,"zero":0},
{"x":6,"irf":-0.6104829136860934,"ci_lo":-0.7953106654610781,"ci_hi":-0.42565516191110875,"zero":0},
{"x":7,"irf":-1.1943368802779244,"ci_lo":-1.303382645014042,"ci_hi":-1.0852911155418068,"zero":0},
{"x":8,"irf":-0.48318407420451875,"ci_lo":-0.5765064064379328,"ci_hi":-0.38986174197110474,"zero":0},
{"x":9,"irf":-1.4196785598121784,"ci_lo":-1.5183064737384555,"ci_hi":-1.3210506458859013,"zero":0},
{"x":10,"irf":-0.3229722552086369,"ci_lo":-0.39503463808307226,"ci_hi":-0.2509098723342016,"zero":0},
{"x":11,"irf":-0.16517288385793114,"ci_lo":-0.2224716842855041,"ci_hi":-0.10787408343035818,"zero":0},
{"x":12,"irf":-1.1626442228966472,"ci_lo":-1.2527507739526766,"ci_hi":-1.0725376718406177,"zero":0},
{"x":13,"irf":0.24024037432414808,"ci_lo":0.18369225150019125,"ci_hi":0.2967884971481049,"zero":0},
{"x":14,"irf":-1.421989719137057,"ci_lo":-1.4948923411464698,"ci_hi":-1.349087097127644,"zero":0},
{"x":15,"irf":0.4695517338164926,"ci_lo":0.36475808656794284,"ci_hi":0.5743453810650424,"zero":0},
{"x":16,"irf":0.6768087629742727,"ci_lo":0.6149603581959437,"ci_hi":0.7386571677526017,"zero":0},
{"x":17,"irf":1.0283239543790024,"ci_lo":0.9675507451038371,"ci_hi":1.0890971636541678,"zero":0},
{"x":18,"irf":0.1737434678967177,"ci_lo":0.11112872128501586,"ci_hi":0.23635821450841957,"zero":0},
{"x":19,"irf":0.7124397149245365,"ci_lo":0.6521023816768974,"ci_hi":0.7727770481721756,"zero":0},
{"x":20,"irf":0.7966792132469169,"ci_lo":0.7275601374482569,"ci_hi":0.865798289045577,"zero":0}];
    const series = [{"name":"LP-IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#lpirf_29');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":0.024383690264948004,"ci_lo":0.023471450140703898,"ci_hi":0.02529593038919211,"zero":0},
{"x":1,"irf":-0.00887553465178651,"ci_lo":-0.009606323554070609,"ci_hi":-0.00814474574950241,"zero":0},
{"x":2,"irf":-0.0014182882368607172,"ci_lo":-0.002704817567551511,"ci_hi":-0.00013175890616992365,"zero":0},
{"x":3,"irf":0.008837773173331186,"ci_lo":0.00815944766866208,"ci_hi":0.009516098678000292,"zero":0},
{"x":4,"irf":-0.0034774868432617275,"ci_lo":-0.00423047105885642,"ci_hi":-0.0027245026276670353,"zero":0},
{"x":5,"irf":-0.011697790236472053,"ci_lo":-0.012466035270950238,"ci_hi":-0.010929545201993868,"zero":0},
{"x":6,"irf":0.004328302073989848,"ci_lo":0.003783964921260341,"ci_hi":0.004872639226719356,"zero":0},
{"x":7,"irf":0.006215350922826401,"ci_lo":0.005622934576807516,"ci_hi":0.006807767268845286,"zero":0},
{"x":8,"irf":-0.0013568681285790521,"ci_lo":-0.002023657678247091,"ci_hi":-0.0006900785789110131,"zero":0},
{"x":9,"irf":-0.013248480336317696,"ci_lo":-0.014074814778696536,"ci_hi":-0.012422145893938856,"zero":0},
{"x":10,"irf":0.01008667048686523,"ci_lo":0.009386117408805919,"ci_hi":0.01078722356492454,"zero":0},
{"x":11,"irf":0.008688297502459918,"ci_lo":0.008023647748359073,"ci_hi":0.009352947256560764,"zero":0},
{"x":12,"irf":0.004195275983981556,"ci_lo":0.0035352211307110794,"ci_hi":0.004855330837252033,"zero":0},
{"x":13,"irf":-0.005359703690868627,"ci_lo":-0.005994942975958707,"ci_hi":-0.0047244644057785464,"zero":0},
{"x":14,"irf":-0.004150051260283188,"ci_lo":-0.0048686566548896216,"ci_hi":-0.003431445865676755,"zero":0},
{"x":15,"irf":0.0009225497727198771,"ci_lo":9.244830412358479e-5,"ci_hi":0.0017526512413161693,"zero":0},
{"x":16,"irf":-0.002971712129174091,"ci_lo":-0.0039029364443871253,"ci_hi":-0.002040487813961057,"zero":0},
{"x":17,"irf":0.012710756533262748,"ci_lo":0.011955717661834188,"ci_hi":0.013465795404691309,"zero":0},
{"x":18,"irf":-0.008599326233066626,"ci_lo":-0.009325484952954039,"ci_hi":-0.007873167513179213,"zero":0},
{"x":19,"irf":0.0025060054717973507,"ci_lo":0.0019488480468025206,"ci_hi":0.003063162896792181,"zero":0},
{"x":20,"irf":-0.007898679804098108,"ci_lo":-0.008482835424427343,"ci_hi":-0.007314524183768874,"zero":0}];
    const series = [{"name":"LP-IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#lpirf_30');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>