<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Static Factor Model (r=3)</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(100% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">Static Factor Model (r=3)</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">Scree Plot</div>
<div id="fm_scree_87"></div>
</div>
<div class="panel">
<div class="panel-title">Extracted Factors</div>
<div id="fm_fac_88"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":"PC 1","eig":1.576475077312052},
{"x":"PC 2","eig":1.425974907790608},
{"x":"PC 3","eig":1.393299188283325},
{"x":"PC 4","eig":1.3156745770615568},
{"x":"PC 5","eig":1.2842463069058043},
{"x":"PC 6","eig":1.1941256736732604},
{"x":"PC 7","eig":1.148115119440333},
{"x":"PC 8","eig":1.0882397606097078},
{"x":"PC 9","eig":1.0356753088683555},
{"x":"PC 10","eig":0.9970448393431479}];
    const series = [{"name":"Eigenvalue","color":"#1f77b4","key":"eig","dash":""}];
    const mode = 'grouped';

    const container = d3.select('#fm_scree_87');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleBand().domain(data.map(d=>d.x)).range([0,w]).padding(0.15);

    let yMin = 0, yMax = 0;
    if(mode === 'stacked') {
        const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetDiverging);
        const stacked = stack(data);
        stacked.forEach(layer => layer.forEach(d => {
            yMin = Math.min(yMin, d[0], d[1]);
            yMax = Math.max(yMax, d[0], d[1]);
        }));
        const yPad = (yMax - yMin) * 0.08 || 1;
        const y = d3.scaleLinear().domain([yMin - yPad, yMax + yPad]).range([h, 0]);

        g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
        g.selectAll('.layer').data(stacked).join('g').attr('class','layer')
            .attr('fill', (d,i) => series[i].color)
            .selectAll('rect').data(d => d).join('rect')
            .attr('x', d => x(d.data.x))
            .attr('y', d => y(Math.max(d[0], d[1])))
            .attr('height', d => Math.abs(y(d[0]) - y(d[1])))
            .attr('width', x.bandwidth());

        // Zero line
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(0)).attr('y2',y(0))
            .attr('stroke','#333').attr('stroke-width',0.8);

        g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
            .call(d3.axisBottom(x).tickValues(x.domain().filter((d,i) =>
                i % Math.max(1,Math.floor(data.length/8)) === 0)));
        g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));
    } else {
        // Grouped
        data.forEach(d => keys.forEach(k => {
            yMin = Math.min(yMin, d[k]||0);
            yMax = Math.max(yMax, d[k]||0);
        }));
        const yPad = (yMax - yMin) * 0.08 || 1;
        const y = d3.scaleLinear().domain([yMin - yPad, yMax + yPad]).range([h, 0]);
        const x1 = d3.scaleBand().domain(keys).range([0, x.bandwidth()]).padding(0.05);

        g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
        g.selectAll('.group').data(data).join('g').attr('class','group')
            .attr('transform', d => 'translate('+x(d.x)+',0)')
            .selectAll('rect').data(d => keys.map(k => ({key:k, val:d[k]||0})))
            .join('rect')
            .attr('x', d => x1(d.key))
            .attr('y', d => y(Math.max(0, d.val)))
            .attr('height', d => Math.abs(y(0) - y(d.val)))
            .attr('width', x1.bandwidth())
            .attr('fill', d => series.find(s=>s.key===d.key).color);

        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(0)).attr('y2',y(0))
            .attr('stroke','#333').attr('stroke-width',0.8);

        g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
            .call(d3.axisBottom(x).tickValues(x.domain().filter((d,i) =>
                i % Math.max(1,Math.floor(data.length/8)) === 0)));
        g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));
    }

    if('') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('');
    if('Eigenvalue') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Eigenvalue');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
            gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color);
            gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
        });
    }

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const bands = x.domain();
            const idx = Math.min(Math.floor(mx / (w / bands.length)), bands.length-1);
            const d = data[Math.max(0,idx)];
            if(!d) return;
            let html = '<b>'+d.x+'</b>';
            series.forEach(s => { if(d[s.key]!==undefined) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"v1":-0.26220608174435645,"v2":1.0446631520186047,"v3":1.7803668688083918},
{"x":2,"v1":0.4155355914375116,"v2":1.1006324440911934,"v3":-0.28467630953360523},
{"x":3,"v1":0.3640939331133909,"v2":0.05414255282381698,"v3":1.425365272749771},
{"x":4,"v1":0.7160891479938863,"v2":-1.314234449816419,"v3":1.359604539941944},
{"x":5,"v1":-0.008687848469680218,"v2":-0.28205483871672116,"v3":-0.16666682844637323},
{"x":6,"v1":-1.5225874611320918,"v2":-2.400293835923972,"v3":-0.3267612071882282},
{"x":7,"v1":0.6635719686296953,"v2":2.734228406764105,"v3":-1.3851091306569199},
{"x":8,"v1":-0.4051755540291162,"v2":0.16985148350886856,"v3":0.7450304785506116},
{"x":9,"v1":1.5577882127429235,"v2":-1.9886598656422039,"v3":0.12256480282994947},
{"x":10,"v1":-1.457429188841376,"v2":1.5558678936025243,"v3":-0.35224723679555703},
{"x":11,"v1":-1.236920844166309,"v2":0.8151035315771283,"v3":1.04786145024898},
{"x":12,"v1":-0.8141688093521452,"v2":-0.21328918448408618,"v3":-1.519199960820938},
{"x":13,"v1":1.8056826713478875,"v2":0.16445505958640128,"v3":-1.4680815893254437},
{"x":14,"v1":-1.2970505812002757,"v2":0.26710640491108517,"v3":-0.6940482699996583},
{"x":15,"v1":-0.06614762772603047,"v2":0.28043393952559487,"v3":0.1923534063508587},
{"x":16,"v1":-1.4027953034379752,"v2":0.2675666032444517,"v3":-0.6338725986798063},
{"x":17,"v1":-1.497219012406267,"v2":1.8895672067116285,"v3":0.3843845312742207},
{"x":18,"v1":-0.281987782911289,"v2":0.28253722577345713,"v3":3.480611978195744},
{"x":19,"v1":-2.5969567155445383,"v2":0.16536457220676076,"v3":-0.44114928199087344},
{"x":20,"v1":-0.6812698545061416,"v2":-1.4172316822184008,"v3":1.3452153322751932},
{"x":21,"v1":0.2518708600997021,"v2":0.156120292527902,"v3":-1.8871337780539286},
{"x":22,"v1":1.0771031645811686,"v2":1.5786895746822993,"v3":-0.5250691794955483},
{"x":23,"v1":0.5931021027872642,"v2":-0.5101343770072341,"v3":0.746096910938043},
{"x":24,"v1":0.5726838886598743,"v2":0.7849069060097081,"v3":-2.4848059542952776},
{"x":25,"v1":0.2286119244574413,"v2":2.448196872892419,"v3":-1.4043102892368737},
{"x":26,"v1":1.8565807432544033,"v2":0.3665971913231913,"v3":-1.0518390937082385},
{"x":27,"v1":-1.8229064153204368,"v2":-0.16228749839931425,"v3":-1.8511977915888462},
{"x":28,"v1":0.8620699891755494,"v2":-1.9402224976808768,"v3":-0.008249830639613057},
{"x":29,"v1":-1.1952942231928063,"v2":-0.8620455026938706,"v3":1.7392853452378065},
{"x":30,"v1":-1.8843836046586773,"v2":-0.43827234661674513,"v3":0.2702903005735775},
{"x":31,"v1":0.5672929798000959,"v2":0.8439435071286451,"v3":1.5786201001765257},
{"x":32,"v1":-0.04049519514094557,"v2":1.3237187752844553,"v3":-0.20020030853010834},
{"x":33,"v1":-0.6760860729079281,"v2":-0.37340458493791767,"v3":-0.27980127740246236},
{"x":34,"v1":-0.00045558153852818454,"v2":-1.187997230508952,"v3":3.3530399301284466},
{"x":35,"v1":0.6985723548187887,"v2":0.5500128762677837,"v3":0.6427184224980774},
{"x":36,"v1":-1.3239290201891278,"v2":0.44686213911921013,"v3":-0.13846205168646766},
{"x":37,"v1":2.18401507916561,"v2":0.2005931368921522,"v3":-0.328978846508194},
{"x":38,"v1":-0.3372314313407185,"v2":-1.6706310788644774,"v3":-1.5418541574540676},
{"x":39,"v1":-0.2002169113578668,"v2":-1.6152476009141816,"v3":-1.4659971155169924},
{"x":40,"v1":0.9945606928967421,"v2":-0.7598012353070733,"v3":1.5664351898358804},
{"x":41,"v1":1.1276343205343893,"v2":1.2594331284987088,"v3":-0.38527400205172774},
{"x":42,"v1":-2.2882551647576146,"v2":0.17526676656207008,"v3":-0.8628494090271805},
{"x":43,"v1":0.005052849609661537,"v2":0.8421813816098024,"v3":-0.18540795189570505},
{"x":44,"v1":0.1015974254900757,"v2":-1.175056480695218,"v3":-0.8272370349105439},
{"x":45,"v1":1.3377353845785986,"v2":-0.48821111648209414,"v3":-0.6587280313461521},
{"x":46,"v1":0.2727503395365301,"v2":0.25455252887761437,"v3":1.7639164049944154},
{"x":47,"v1":-0.6193582120112535,"v2":-0.11878568088690257,"v3":0.8187920107093717},
{"x":48,"v1":1.3880933278058392,"v2":2.2350521655355653,"v3":-0.5235569958864953},
{"x":49,"v1":1.9946173881159028,"v2":0.9200507775667182,"v3":-0.04927624339561382},
{"x":50,"v1":1.9730592351305958,"v2":-0.7181939193324458,"v3":-0.38716844241085524},
{"x":51,"v1":-1.4179511672412588,"v2":0.1947748969550049,"v3":0.24310292967790845},
{"x":52,"v1":1.1803007326329062,"v2":0.476160005146525,"v3":-0.7028128281454692},
{"x":53,"v1":-0.530585987134837,"v2":-1.6535783217088091,"v3":-0.03308853214491825},
{"x":54,"v1":-1.4218949616865948,"v2":-0.5454210358346592,"v3":0.8012558694026112},
{"x":55,"v1":-0.7090034412551143,"v2":-0.24508428968530557,"v3":-0.7977836578423336},
{"x":56,"v1":-0.8456648906617947,"v2":0.3042854208565067,"v3":-0.3594451836811155},
{"x":57,"v1":-0.4158295066610222,"v2":0.8241681167974048,"v3":-0.3224470024623099},
{"x":58,"v1":1.4108567725536127,"v2":-0.23277585057572303,"v3":0.1643884272281494},
{"x":59,"v1":1.7250762844543006,"v2":1.2405636169246865,"v3":-1.7327006788321908},
{"x":60,"v1":-1.66748485785318,"v2":0.9928078044937507,"v3":-0.4208794511363277},
{"x":61,"v1":0.6685668706653038,"v2":0.6248969157724824,"v3":-2.535572988861114},
{"x":62,"v1":-1.4526489791619142,"v2":-1.7194513674687302,"v3":0.3655788174559494},
{"x":63,"v1":0.8877110075553541,"v2":-0.8835122015522742,"v3":-1.003400429533423},
{"x":64,"v1":0.749346541109049,"v2":0.8168637246638152,"v3":1.2969427018922486},
{"x":65,"v1":-0.09280662821393848,"v2":1.9085768303512896,"v3":-1.3662797360486607},
{"x":66,"v1":0.45408233949626986,"v2":1.0857666024966128,"v3":1.3058832396482019},
{"x":67,"v1":-0.5097450714528615,"v2":-2.0520878088039662,"v3":-0.47480281378439043},
{"x":68,"v1":-0.4452038676240145,"v2":-1.460272483884982,"v3":0.8691100860844729},
{"x":69,"v1":-1.0777696943989372,"v2":-1.580996791820516,"v3":-0.1701042660223554},
{"x":70,"v1":1.6638150992754088,"v2":-0.7215922060368988,"v3":1.6612926039698286},
{"x":71,"v1":0.4373376217721165,"v2":-0.2012513999296496,"v3":0.7226270525681906},
{"x":72,"v1":-1.074444388299877,"v2":-1.3272953236848517,"v3":0.6194034918757969},
{"x":73,"v1":-0.27301855144226755,"v2":-0.6337013950477798,"v3":-0.9324124958674704},
{"x":74,"v1":0.17730839750569263,"v2":-0.17143656156138448,"v3":-0.7041450685769385},
{"x":75,"v1":-0.35989087471306547,"v2":0.1160326631569144,"v3":-1.3123710345955089},
{"x":76,"v1":0.07728831381192718,"v2":1.157000566688286,"v3":-0.9818435030402283},
{"x":77,"v1":0.9034860126606288,"v2":0.5142970993055602,"v3":-0.8177726457777217},
{"x":78,"v1":-1.8067374399722183,"v2":1.6308232740694344,"v3":1.854575804113464},
{"x":79,"v1":0.05180927150974249,"v2":0.9236062189282271,"v3":0.6770077474857613},
{"x":80,"v1":0.4983705036369831,"v2":-0.41235508871018445,"v3":-0.2199552146464631},
{"x":81,"v1":0.048696363583805066,"v2":0.529506991349761,"v3":-0.8561770310668739},
{"x":82,"v1":1.61269598815977,"v2":-1.6557447364980702,"v3":0.3173440580758161},
{"x":83,"v1":2.1140868352401267,"v2":0.32231949347190236,"v3":-2.4121274038874985},
{"x":84,"v1":-0.608302730412041,"v2":-0.05742850583648846,"v3":1.6580178429791934},
{"x":85,"v1":-0.7047151996724285,"v2":1.4213602202743778,"v3":0.5673153733011463},
{"x":86,"v1":0.28385304850439075,"v2":0.4939458823900849,"v3":-0.3472457798893605},
{"x":87,"v1":-1.6673880511638897,"v2":-0.9456139032506857,"v3":0.5110334087936635},
{"x":88,"v1":0.9169398913851883,"v2":-0.5884755932925856,"v3":0.16578354418408092},
{"x":89,"v1":0.11628187771281168,"v2":0.7589006435360218,"v3":-0.12651144298541428},
{"x":90,"v1":-0.12826677440285236,"v2":0.03173898385210026,"v3":1.3036437052374785},
{"x":91,"v1":0.4185488128274976,"v2":-0.5358991482019047,"v3":-1.705594771239265},
{"x":92,"v1":-0.9307752496297208,"v2":-0.09307045822929437,"v3":0.33453278757630983},
{"x":93,"v1":-0.20234593705806592,"v2":-1.226788670126354,"v3":-0.8233539379698221},
{"x":94,"v1":0.5827226952960995,"v2":-1.8348576300777,"v3":-1.3975044199150435},
{"x":95,"v1":0.5375897759074943,"v2":-0.04374607143453778,"v3":-1.7110257341494375},
{"x":96,"v1":0.8312576364126829,"v2":-0.8575193707379882,"v3":1.2041866198084508},
{"x":97,"v1":0.6590350260877823,"v2":-1.858082061294069,"v3":-0.8523607476197559},
{"x":98,"v1":-0.4323052068994889,"v2":-1.2716610251185188,"v3":0.6210999128326506},
{"x":99,"v1":2.4561508047504397,"v2":0.9286539574279813,"v3":2.249300562171122},
{"x":100,"v1":1.0602081957389422,"v2":0.822356030717477,"v3":-1.0988592234976395},
{"x":101,"v1":1.3021680267261095,"v2":2.4529276130927737,"v3":0.897999145903799},
{"x":102,"v1":-1.4624097948509138,"v2":1.663646913884496,"v3":-0.9932190552324512},
{"x":103,"v1":1.8185427147955773,"v2":-0.432548809919661,"v3":0.8950157000827998},
{"x":104,"v1":1.4374461093598172,"v2":1.7794461019621235,"v3":1.926899718676095},
{"x":105,"v1":-0.904396308589351,"v2":0.6326666821366758,"v3":-0.6847831314327439},
{"x":106,"v1":-0.24321893496969252,"v2":0.7416671741246582,"v3":-2.1223326038217754},
{"x":107,"v1":-1.177743726562834,"v2":-1.4119632905174375,"v3":-0.9590782070866083},
{"x":108,"v1":-2.9853847654153354,"v2":-2.015182146504002,"v3":-0.9771897162397071},
{"x":109,"v1":-3.0726461869632984,"v2":-0.310061917582058,"v3":-0.49084993553050615},
{"x":110,"v1":-0.18203425710480728,"v2":0.936478850820823,"v3":-2.0011657253925637},
{"x":111,"v1":-0.0009715084372395501,"v2":0.0737839210663482,"v3":-0.5734909495665992},
{"x":112,"v1":0.6816923030235063,"v2":-1.156174034993355,"v3":1.0134778323273532},
{"x":113,"v1":-1.2757470714643702,"v2":-1.08144469607511,"v3":1.2697427395676442},
{"x":114,"v1":2.0727131015507836,"v2":0.07353912944704168,"v3":1.818218879930412},
{"x":115,"v1":2.7149226337245045,"v2":1.7858627294077212,"v3":0.07469129193772338},
{"x":116,"v1":-2.2090987062848115,"v2":-0.8326500259539518,"v3":-1.1282633481294857},
{"x":117,"v1":-0.5568905618693091,"v2":1.809985185118729,"v3":-0.023280883695065535},
{"x":118,"v1":1.013399471199894,"v2":-0.7414955159951404,"v3":0.7883367029070208},
{"x":119,"v1":-1.9875314048060746,"v2":1.5638375655520342,"v3":-0.8417996486946552},
{"x":120,"v1":2.1200898412366636,"v2":-1.1511897752307543,"v3":-2.0320152535342766},
{"x":121,"v1":-0.8548707679436792,"v2":2.43620365120213,"v3":0.15901858249777354},
{"x":122,"v1":-1.5614161403275706,"v2":0.04839392181227148,"v3":0.5242196974387009},
{"x":123,"v1":0.7440648058225168,"v2":0.9138516078515826,"v3":1.1109662328602876},
{"x":124,"v1":-1.7015919869051204,"v2":1.409354584043221,"v3":0.749603049358343},
{"x":125,"v1":-0.3314115760454573,"v2":-2.110929031650541,"v3":-0.6469438713638124},
{"x":126,"v1":-0.3037710945446774,"v2":-0.9209251510969738,"v3":0.6550955235232435},
{"x":127,"v1":-1.4345770259859503,"v2":0.5294692527459212,"v3":0.6767698186365239},
{"x":128,"v1":0.8063800274046924,"v2":1.7188019364231095,"v3":1.880970192794901},
{"x":129,"v1":-0.3702839726066961,"v2":2.472906547862517,"v3":0.10484860683421117},
{"x":130,"v1":0.3641182400740204,"v2":-2.0119360239880604,"v3":-0.5520506024754047},
{"x":131,"v1":0.05412910802324096,"v2":0.9716029024510257,"v3":1.3539011713417561},
{"x":132,"v1":0.39646811396138326,"v2":-1.2926279868363406,"v3":2.451262894515841},
{"x":133,"v1":-0.3410321481122041,"v2":0.08723965282125426,"v3":-1.6373057969519407},
{"x":134,"v1":0.3935136405096281,"v2":-1.1127719436184893,"v3":1.2222556010621646},
{"x":135,"v1":-0.9782497156256043,"v2":0.7908574291824216,"v3":-0.833713451284787},
{"x":136,"v1":1.487181192463329,"v2":-0.1883764509938024,"v3":0.11468063486636682},
{"x":137,"v1":1.5514065688943903,"v2":-1.5047184066088535,"v3":-0.8440457988585551},
{"x":138,"v1":-0.8282239598225217,"v2":1.1655506133038978,"v3":0.7893201634196702},
{"x":139,"v1":-0.5953772327537127,"v2":-1.4591700374566323,"v3":-0.12097946616389922},
{"x":140,"v1":1.2063982880135526,"v2":0.25239177720657935,"v3":0.31342957725263026},
{"x":141,"v1":-1.5073109666301296,"v2":0.003228121737701759,"v3":-0.13687044865498368},
{"x":142,"v1":0.4080726941667122,"v2":2.012643623081291,"v3":1.8749027902231916},
{"x":143,"v1":-1.0439139897345657,"v2":-0.044546584454464265,"v3":1.4430845834824344},
{"x":144,"v1":-0.19757205510883588,"v2":1.5240063955638865,"v3":0.40085700511845285},
{"x":145,"v1":0.6130013831758784,"v2":2.7486562687233285,"v3":-0.8323697576686313},
{"x":146,"v1":-0.3215337586177816,"v2":-0.3556577291207455,"v3":-2.5513979919555485},
{"x":147,"v1":-0.5095670661027499,"v2":-1.9201527183348717,"v3":-0.16877951432141086},
{"x":148,"v1":-1.485430478813128,"v2":-0.47303768199564405,"v3":-0.740609446137769},
{"x":149,"v1":-0.4917036344439753,"v2":-1.1097846261381754,"v3":1.1519805787109587},
{"x":150,"v1":-1.3310669781553641,"v2":0.46921373479851897,"v3":1.3809648676995934},
{"x":151,"v1":-1.991943112641403,"v2":-0.9505439323319966,"v3":0.15595121793444922},
{"x":152,"v1":-1.6570230679603668,"v2":0.010114685782417577,"v3":0.8323733794731357},
{"x":153,"v1":0.32814933302926774,"v2":-0.011550264032234584,"v3":-0.28484413233355294},
{"x":154,"v1":2.033370833743516,"v2":-3.955816187753575,"v3":1.140218743484855},
{"x":155,"v1":0.2724992076984297,"v2":-0.3871593820710361,"v3":-1.2689156864504223},
{"x":156,"v1":0.13265956364890305,"v2":-3.8275852179793657,"v3":0.22362692477254467},
{"x":157,"v1":0.5759262732369742,"v2":-1.742907410214993,"v3":0.021481327159415715},
{"x":158,"v1":-0.9010741437713631,"v2":0.18977321063005323,"v3":1.8250183767643116},
{"x":159,"v1":3.2318046481568623,"v2":0.6334261638398272,"v3":0.4161042059237025},
{"x":160,"v1":-1.6570929187314665,"v2":-1.5561243086463818,"v3":0.46760949094288473},
{"x":161,"v1":-1.3321416012786824,"v2":-0.7611793334255991,"v3":-0.5027342326063062},
{"x":162,"v1":0.8096290378521549,"v2":-0.9997237758297177,"v3":-0.31579912737886445},
{"x":163,"v1":2.8625107255338524,"v2":0.30336197719454694,"v3":0.41411825542506314},
{"x":164,"v1":0.9940324679111525,"v2":0.41149293282890403,"v3":1.7337831885338784},
{"x":165,"v1":-0.7723067230453535,"v2":0.644014408283785,"v3":-0.14148950460689932},
{"x":166,"v1":0.668868083325018,"v2":-0.36198225311404014,"v3":-0.12914706802321632},
{"x":167,"v1":-1.3924772484179002,"v2":0.7994990916343093,"v3":0.4438997533851155},
{"x":168,"v1":-0.2704358337806745,"v2":-0.6685257877338625,"v3":-1.7459330017586059},
{"x":169,"v1":-0.520838841903759,"v2":0.24845128405687078,"v3":-2.3287536829265214},
{"x":170,"v1":0.4542372986544075,"v2":0.07912700773972933,"v3":0.006328466888591084},
{"x":171,"v1":0.45963303292385554,"v2":2.059801721703811,"v3":1.2065171614170538},
{"x":172,"v1":-1.1117305613517041,"v2":0.6853684021863103,"v3":-0.3199173952407972},
{"x":173,"v1":-0.9861427998092485,"v2":0.21421666973471779,"v3":0.24974017410538726},
{"x":174,"v1":0.05862984065198884,"v2":0.3374277244808641,"v3":-0.571775381650424},
{"x":175,"v1":-0.19845661730287478,"v2":0.8427723806126717,"v3":-3.8566720687990768},
{"x":176,"v1":-0.16984000955400042,"v2":1.2900240273687307,"v3":1.2117571705391472},
{"x":177,"v1":0.269388199934436,"v2":-0.11492392047154898,"v3":-1.8016615357380221},
{"x":178,"v1":0.9313889605276451,"v2":0.2762400646638436,"v3":1.0982520811476655},
{"x":179,"v1":1.0646597341737738,"v2":-0.2251989950029556,"v3":-2.228985950966869},
{"x":180,"v1":1.9844937664774216,"v2":-1.3197939382683916,"v3":0.8547083455742471},
{"x":181,"v1":0.03770368697441544,"v2":-0.5434735440554783,"v3":2.0765000812686387},
{"x":182,"v1":0.711541840430209,"v2":0.3298515681347929,"v3":-0.21079221295148837},
{"x":183,"v1":2.7763564207854543,"v2":-1.0793686372437519,"v3":0.19866299713627428},
{"x":184,"v1":-3.3951199511772088,"v2":0.7977481228506503,"v3":1.203788916048034},
{"x":185,"v1":-0.8321053346786295,"v2":0.21216553650630945,"v3":2.366610873556924},
{"x":186,"v1":-0.965531109715071,"v2":0.7684778460822683,"v3":-1.8601085066839909},
{"x":187,"v1":-0.971390255249785,"v2":-0.9527117185682177,"v3":-1.0311972560307157},
{"x":188,"v1":0.8957393496181861,"v2":2.5328257534342264,"v3":0.1699929613547446},
{"x":189,"v1":2.0256232808909838,"v2":0.28922908589645735,"v3":0.7871343506558037},
{"x":190,"v1":-0.9103800736048983,"v2":0.4650190562387394,"v3":0.17442682949522748},
{"x":191,"v1":-1.6715114733436978,"v2":1.687747084687859,"v3":1.3487552612388831},
{"x":192,"v1":-2.933730089438741,"v2":-0.9447346763659189,"v3":0.3095679297510291},
{"x":193,"v1":1.0453847286778852,"v2":-0.5776827751260399,"v3":-1.5965418573573806},
{"x":194,"v1":1.5870864262236952,"v2":0.7503759954776152,"v3":-0.3542759451226351},
{"x":195,"v1":0.45461509869710326,"v2":-0.9680392635216025,"v3":-0.21450561752055408},
{"x":196,"v1":1.0855169358453336,"v2":-0.3355736360381418,"v3":0.15083943057613125},
{"x":197,"v1":0.1778828725524691,"v2":0.5215128324353276,"v3":-0.06107404775504646},
{"x":198,"v1":-0.08347815313711357,"v2":-2.533435784705733,"v3":0.7643766840272435},
{"x":199,"v1":4.059618715498354,"v2":-1.4810078107472269,"v3":-0.365207231926181},
{"x":200,"v1":0.3578747265767838,"v2":0.6367584671860915,"v3":0.8500162454875118}];
    const series = [{"name":"Factor 1","color":"#1f77b4","key":"v1","dash":""},{"name":"Factor 2","color":"#ff7f0e","key":"v2","dash":""},{"name":"Factor 3","color":"#2ca02c","key":"v3","dash":""}];
    const bands = [];
    const refLines = [];

    const container = d3.select('#fm_fac_88');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Period') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Period');
    if('Factor Value') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Factor Value');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>