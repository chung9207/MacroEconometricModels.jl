<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Nowcast Result (dfm)</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(33% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">Nowcast Result (dfm)</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">Target (col 5) â€” Nowcast: 0.014, Forecast: 0.036</div>
<div id="nc_target_96"></div>
</div>
<div class="panel">
<div class="panel-title">Variable 1</div>
<div id="nc_var_97"></div>
</div>
<div class="panel">
<div class="panel-title">Variable 2</div>
<div id="nc_var_98"></div>
</div>
<div class="panel">
<div class="panel-title">Variable 3</div>
<div id="nc_var_99"></div>
</div>
<div class="panel">
<div class="panel-title">Variable 4</div>
<div id="nc_var_100"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":1,"v1":0.13},
{"x":2,"v1":0.10999999999999988},
{"x":3,"v1":0.010000000000000009},
{"x":4,"v1":-0.010000000000000009},
{"x":5,"v1":0.0},
{"x":6,"v1":0.010000000000000009},
{"x":7,"v1":0.14000000000000012},
{"x":8,"v1":0.10999999999999988},
{"x":9,"v1":0.010000000000000009},
{"x":10,"v1":0.09000000000000008},
{"x":11,"v1":0.17999999999999994},
{"x":12,"v1":0.010000000000000009},
{"x":13,"v1":0.1200000000000001},
{"x":14,"v1":0.08999999999999986},
{"x":15,"v1":0.0},
{"x":16,"v1":0.040000000000000036},
{"x":17,"v1":0.24},
{"x":18,"v1":0.010000000000000231},
{"x":19,"v1":0.06999999999999984},
{"x":20,"v1":0.1299999999999999},
{"x":21,"v1":0.0},
{"x":22,"v1":0.010000000000000231},
{"x":23,"v1":0.009999999999999787},
{"x":24,"v1":-0.029999999999999805},
{"x":25,"v1":-0.010000000000000231},
{"x":26,"v1":0.020000000000000018},
{"x":27,"v1":-0.27},
{"x":28,"v1":-0.08999999999999986},
{"x":29,"v1":-0.20999999999999996},
{"x":30,"v1":-0.28},
{"x":31,"v1":0.0},
{"x":32,"v1":0.0},
{"x":33,"v1":0.030000000000000027},
{"x":34,"v1":-0.93},
{"x":35,"v1":-0.6},
{"x":36,"v1":0.0},
{"x":37,"v1":0.03},
{"x":38,"v1":0.009999999999999995},
{"x":39,"v1":0.010000000000000009},
{"x":40,"v1":-0.010000000000000009},
{"x":41,"v1":0.0},
{"x":42,"v1":0.0},
{"x":43,"v1":0.0},
{"x":44,"v1":0.0},
{"x":45,"v1":-0.009999999999999995},
{"x":46,"v1":-0.009999999999999995},
{"x":47,"v1":0.0},
{"x":48,"v1":-0.010000000000000009},
{"x":49,"v1":0.020000000000000004},
{"x":50,"v1":0.020000000000000004},
{"x":51,"v1":-0.010000000000000009},
{"x":52,"v1":-0.009999999999999995},
{"x":53,"v1":0.0},
{"x":54,"v1":0.0},
{"x":55,"v1":0.0},
{"x":56,"v1":0.0},
{"x":57,"v1":0.0},
{"x":58,"v1":0.12000000000000001},
{"x":59,"v1":0.13},
{"x":60,"v1":0.44},
{"x":61,"v1":0.43999999999999995},
{"x":62,"v1":0.47},
{"x":63,"v1":0.6500000000000001},
{"x":64,"v1":0.22999999999999998},
{"x":65,"v1":0.52},
{"x":66,"v1":0.6999999999999997},
{"x":67,"v1":0.31999999999999984},
{"x":68,"v1":0.23000000000000043},
{"x":69,"v1":0.2400000000000002},
{"x":70,"v1":0.08000000000000007},
{"x":71,"v1":0.17999999999999972},
{"x":72,"v1":0.22999999999999954},
{"x":73,"v1":0.020000000000000462},
{"x":74,"v1":0.040000000000000036},
{"x":75,"v1":0.20999999999999996},
{"x":76,"v1":0.0},
{"x":77,"v1":0.0},
{"x":78,"v1":0.0},
{"x":79,"v1":0.0},
{"x":80,"v1":0.0},
{"x":81,"v1":0.0},
{"x":82,"v1":0.0},
{"x":83,"v1":0.0},
{"x":84,"v1":0.0},
{"x":85,"v1":0.0},
{"x":86,"v1":0.0},
{"x":87,"v1":0.0},
{"x":88,"v1":-0.20000000000000018},
{"x":89,"v1":-0.2999999999999998},
{"x":90,"v1":-0.1900000000000004},
{"x":91,"v1":-0.15999999999999925},
{"x":92,"v1":-0.15000000000000036},
{"x":93,"v1":0.0},
{"x":94,"v1":0.0},
{"x":95,"v1":0.0},
{"x":96,"v1":0.0},
{"x":97,"v1":0.0},
{"x":98,"v1":0.0},
{"x":99,"v1":0.0},
{"x":100,"v1":0.014499210093603804}];
    const series = [{"name":"Smoothed","color":"#1f77b4","key":"v1","dash":""}];
    const bands = [];
    const refLines = [];

    const container = d3.select('#nc_target_96');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Period') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Period');
    if('Value') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Value');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"v1":0.0020579802852100926},
{"x":2,"v1":-0.0023975598889283134},
{"x":3,"v1":-0.0041471676206601416},
{"x":4,"v1":0.001031641609603895},
{"x":5,"v1":0.012242951327366747},
{"x":6,"v1":0.002389626780567866},
{"x":7,"v1":0.0019533298635989738},
{"x":8,"v1":-1.872595501151153e-5},
{"x":9,"v1":0.002421606629052775},
{"x":10,"v1":0.004886354634384027},
{"x":11,"v1":0.01095858190317145},
{"x":12,"v1":-0.009045665423148996},
{"x":13,"v1":0.007739323183955982},
{"x":14,"v1":0.0016130706732431221},
{"x":15,"v1":0.006442729109767065},
{"x":16,"v1":0.0006505452749951957},
{"x":17,"v1":-0.0011033900564871857},
{"x":18,"v1":0.0007930645244380585},
{"x":19,"v1":0.0002450018435427026},
{"x":20,"v1":-0.00666522303835837},
{"x":21,"v1":-0.005479088490066175},
{"x":22,"v1":0.0003752804925412079},
{"x":23,"v1":-0.005865977141161771},
{"x":24,"v1":0.0011530983463270417},
{"x":25,"v1":0.00044427195055796176},
{"x":26,"v1":-0.0048606038693659315},
{"x":27,"v1":0.0068257248349024024},
{"x":28,"v1":-0.0033894417233817364},
{"x":29,"v1":-0.008478362664281036},
{"x":30,"v1":0.005006764315212742},
{"x":31,"v1":-0.0023266844944638265},
{"x":32,"v1":-0.006575138580045881},
{"x":33,"v1":0.003356601456009578},
{"x":34,"v1":-0.039905426201024774},
{"x":35,"v1":-0.14142247901545613},
{"x":36,"v1":0.016402914528458545},
{"x":37,"v1":0.06347249159182677},
{"x":38,"v1":0.03678711230080012},
{"x":39,"v1":0.009731960431251352},
{"x":40,"v1":0.00012505093236558906},
{"x":41,"v1":0.008017424837306386},
{"x":42,"v1":0.0035310967909989444},
{"x":43,"v1":0.013112855111043764},
{"x":44,"v1":0.00526452556660395},
{"x":45,"v1":-0.033600576999423204},
{"x":46,"v1":0.028565786232450208},
{"x":47,"v1":0.0017578578773207454},
{"x":48,"v1":0.008834757856392983},
{"x":49,"v1":0.003668089560924237},
{"x":50,"v1":0.004530861445060097},
{"x":51,"v1":-0.002078928094134014},
{"x":52,"v1":-0.01192362503883615},
{"x":53,"v1":0.01334599098044631},
{"x":54,"v1":0.006757498302163434},
{"x":55,"v1":-0.002907100013006314},
{"x":56,"v1":-0.0038553890138945945},
{"x":57,"v1":0.006177379936951333},
{"x":58,"v1":0.005779525289359988},
{"x":59,"v1":0.0004861197143313234},
{"x":60,"v1":-0.0010504332153136176},
{"x":61,"v1":-0.0031183386894699794},
{"x":62,"v1":0.002027284973972421},
{"x":63,"v1":-0.001252475829669919},
{"x":64,"v1":0.001931932369605427},
{"x":65,"v1":-0.000384112746256271},
{"x":66,"v1":-0.0029444934707285597},
{"x":67,"v1":-0.011845400797525052},
{"x":68,"v1":0.007376024221829702},
{"x":69,"v1":0.0013582135715868304},
{"x":70,"v1":0.00375777546565903},
{"x":71,"v1":0.0022988686347238385},
{"x":72,"v1":-0.003208999022467296},
{"x":73,"v1":-0.00804786480502262},
{"x":74,"v1":0.007830856183776547},
{"x":75,"v1":-0.0006681669277961433},
{"x":76,"v1":0.001801245307687438},
{"x":77,"v1":-0.005481179041073148},
{"x":78,"v1":0.003923856488423638},
{"x":79,"v1":-0.00258901106065057},
{"x":80,"v1":-0.013820284885654566},
{"x":81,"v1":0.010653345023457383},
{"x":82,"v1":0.0017186200476606572},
{"x":83,"v1":-0.0021335238777089316},
{"x":84,"v1":0.006161931798148501},
{"x":85,"v1":0.000307300368700858},
{"x":86,"v1":-0.009143304316003409},
{"x":87,"v1":0.004542772371983972},
{"x":88,"v1":-0.006217580718655746},
{"x":89,"v1":-0.0034012836016454884},
{"x":90,"v1":-0.001781025012705939},
{"x":91,"v1":0.01036780188456099},
{"x":92,"v1":-0.0026208646085175147},
{"x":93,"v1":0.010286225390843562},
{"x":94,"v1":-0.0005827653020853418},
{"x":95,"v1":0.0008656154843622588},
{"x":96,"v1":-0.0016071780172621786},
{"x":97,"v1":0.0050680790544692655},
{"x":98,"v1":0.004086103854820777},
{"x":99,"v1":-0.003020436175280139},
{"x":100,"v1":0.0018803671468559102}];
    const series = [{"name":"Smoothed var 1","color":"#1f77b4","key":"v1","dash":""}];
    const bands = [];
    const refLines = [];

    const container = d3.select('#nc_var_97');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Period') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Period');
    if('') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"v1":-0.10000000000000053},
{"x":2,"v1":0.0},
{"x":3,"v1":0.10000000000000053},
{"x":4,"v1":-0.10000000000000053},
{"x":5,"v1":-0.09999999999999964},
{"x":6,"v1":0.0},
{"x":7,"v1":-0.10000000000000053},
{"x":8,"v1":-0.09999999999999964},
{"x":9,"v1":0.09999999999999964},
{"x":10,"v1":-0.09999999999999964},
{"x":11,"v1":0.0},
{"x":12,"v1":-0.20000000000000018},
{"x":13,"v1":0.20000000000000018},
{"x":14,"v1":-0.20000000000000018},
{"x":15,"v1":0.0},
{"x":16,"v1":-0.09999999999999964},
{"x":17,"v1":0.09999999999999964},
{"x":18,"v1":0.0},
{"x":19,"v1":0.10000000000000009},
{"x":20,"v1":0.10000000000000009},
{"x":21,"v1":-0.20000000000000018},
{"x":22,"v1":0.0},
{"x":23,"v1":-0.09999999999999964},
{"x":24,"v1":-0.10000000000000009},
{"x":25,"v1":0.0},
{"x":26,"v1":0.10000000000000009},
{"x":27,"v1":-0.10000000000000009},
{"x":28,"v1":-0.10000000000000009},
{"x":29,"v1":0.10000000000000009},
{"x":30,"v1":0.0},
{"x":31,"v1":0.0},
{"x":32,"v1":0.0},
{"x":33,"v1":-0.10000000000000009},
{"x":34,"v1":0.9000000000000004},
{"x":35,"v1":10.4},
{"x":36,"v1":-1.6000000000000014},
{"x":37,"v1":-2.1999999999999993},
{"x":38,"v1":-0.8000000000000007},
{"x":39,"v1":-1.799999999999999},
{"x":40,"v1":-0.6000000000000005},
{"x":41,"v1":-0.8999999999999995},
{"x":42,"v1":-0.20000000000000018},
{"x":43,"v1":0.0},
{"x":44,"v1":-0.2999999999999998},
{"x":45,"v1":-0.20000000000000018},
{"x":46,"v1":-0.10000000000000053},
{"x":47,"v1":0.0},
{"x":48,"v1":-0.2999999999999998},
{"x":49,"v1":0.10000000000000053},
{"x":50,"v1":-0.5},
{"x":51,"v1":-0.3000000000000007},
{"x":52,"v1":-0.39999999999999947},
{"x":53,"v1":-0.20000000000000018},
{"x":54,"v1":-0.40000000000000036},
{"x":55,"v1":-0.19999999999999973},
{"x":56,"v1":0.10000000000000009},
{"x":57,"v1":-0.10000000000000009},
{"x":58,"v1":-0.19999999999999973},
{"x":59,"v1":0.0},
{"x":60,"v1":-0.10000000000000009},
{"x":61,"v1":0.0},
{"x":62,"v1":-0.10000000000000009},
{"x":63,"v1":0.10000000000000009},
{"x":64,"v1":-0.10000000000000009},
{"x":65,"v1":0.10000000000000009},
{"x":66,"v1":0.0},
{"x":67,"v1":-0.10000000000000009},
{"x":68,"v1":0.0},
{"x":69,"v1":0.10000000000000009},
{"x":70,"v1":-0.10000000000000009},
{"x":71,"v1":-0.10000000000000009},
{"x":72,"v1":0.20000000000000018},
{"x":73,"v1":0.0},
{"x":74,"v1":-0.10000000000000009},
{"x":75,"v1":0.20000000000000018},
{"x":76,"v1":0.0},
{"x":77,"v1":0.19999999999999973},
{"x":78,"v1":-0.19999999999999973},
{"x":79,"v1":0.09999999999999964},
{"x":80,"v1":-0.09999999999999964},
{"x":81,"v1":0.19999999999999973},
{"x":82,"v1":0.0},
{"x":83,"v1":0.0},
{"x":84,"v1":0.0},
{"x":85,"v1":0.19999999999999973},
{"x":86,"v1":0.10000000000000053},
{"x":87,"v1":0.0},
{"x":88,"v1":-0.10000000000000053},
{"x":89,"v1":0.0},
{"x":90,"v1":0.10000000000000053},
{"x":91,"v1":-0.10000000000000053},
{"x":92,"v1":-0.09999999999999964},
{"x":93,"v1":0.20000000000000018},
{"x":94,"v1":0.0},
{"x":95,"v1":0.0},
{"x":96,"v1":0.09999999999999964},
{"x":97,"v1":-0.20000000000000018},
{"x":98,"v1":0.20000000000000018},
{"x":99,"v1":0.0},
{"x":100,"v1":0.10000000000000053}];
    const series = [{"name":"Smoothed var 2","color":"#ff7f0e","key":"v1","dash":""}];
    const bands = [];
    const refLines = [];

    const container = d3.select('#nc_var_98');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Period') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Period');
    if('') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"v1":0.0014256940796917306},
{"x":2,"v1":-0.0003238201380506567},
{"x":3,"v1":0.0035136428427833266},
{"x":4,"v1":0.0012521573773192074},
{"x":5,"v1":-0.0043186444789826695},
{"x":6,"v1":0.0018897025671948953},
{"x":7,"v1":-0.0005597817481461931},
{"x":8,"v1":0.002139651595654435},
{"x":9,"v1":-0.0015556545756503226},
{"x":10,"v1":-0.0024963259746719757},
{"x":11,"v1":0.002408677154569716},
{"x":12,"v1":-0.0003456166223090307},
{"x":13,"v1":-0.0013546650592184406},
{"x":14,"v1":-0.00012022356735386097},
{"x":15,"v1":0.0010052095960375595},
{"x":16,"v1":0.00027443270509319717},
{"x":17,"v1":0.00027668946974124253},
{"x":18,"v1":-0.003041287567648432},
{"x":19,"v1":0.001389099091614554},
{"x":20,"v1":-0.0014999711921515058},
{"x":21,"v1":0.003812072447292536},
{"x":22,"v1":0.0007778995492548901},
{"x":23,"v1":-2.2030441504838905e-5},
{"x":24,"v1":-0.0035058266475829214},
{"x":25,"v1":-0.0005719684981952966},
{"x":26,"v1":0.002630382781233287},
{"x":27,"v1":-0.0013908652400491661},
{"x":28,"v1":0.0006233114190656863},
{"x":29,"v1":0.0012856297646477444},
{"x":30,"v1":-1.1826327980024587e-5},
{"x":31,"v1":9.651950158673372e-5},
{"x":32,"v1":-0.0009881661087520754},
{"x":33,"v1":-0.0014452620181009124},
{"x":34,"v1":-0.005013290023701877},
{"x":35,"v1":-0.003412946596112576},
{"x":36,"v1":0.0070529495737696735},
{"x":37,"v1":0.005734516890250063},
{"x":38,"v1":0.00024771252679745004},
{"x":39,"v1":-0.0013591013808165187},
{"x":40,"v1":-0.001101701833809976},
{"x":41,"v1":-0.0013849877071807626},
{"x":42,"v1":0.0010338414142934127},
{"x":43,"v1":0.002065340771979507},
{"x":44,"v1":-0.0020726707812848133},
{"x":45,"v1":0.00128568281323993},
{"x":46,"v1":0.0012720275306801199},
{"x":47,"v1":0.0018689447325526132},
{"x":48,"v1":-4.0744706833351074e-5},
{"x":49,"v1":0.00190469776058233},
{"x":50,"v1":-0.003929584740655301},
{"x":51,"v1":-0.0017356684818583545},
{"x":52,"v1":0.0014638718775703552},
{"x":53,"v1":0.005042228769051249},
{"x":54,"v1":-0.0011269997722518355},
{"x":55,"v1":-0.0011853956875107485},
{"x":56,"v1":-0.0009201083920924447},
{"x":57,"v1":0.0008307384083030556},
{"x":58,"v1":0.003293036806970129},
{"x":59,"v1":-0.006415744581102167},
{"x":60,"v1":0.005499753448505729},
{"x":61,"v1":0.003498206544161775},
{"x":62,"v1":-0.013316611818229518},
{"x":63,"v1":0.0011998608642569408},
{"x":64,"v1":0.0035039706311685848},
{"x":65,"v1":0.0009858901475405801},
{"x":66,"v1":-0.0027987797441078044},
{"x":67,"v1":-0.0021087742915124608},
{"x":68,"v1":0.005165374890096608},
{"x":69,"v1":-0.002111003580192339},
{"x":70,"v1":-0.0028353024765559454},
{"x":71,"v1":0.003466061973119494},
{"x":72,"v1":-0.0025087323223678126},
{"x":73,"v1":0.001067022375497828},
{"x":74,"v1":-0.0008827620590130536},
{"x":75,"v1":0.003291918649520831},
{"x":76,"v1":-0.0009580300309171008},
{"x":77,"v1":-0.003121989188874963},
{"x":78,"v1":0.0005024088361116341},
{"x":79,"v1":0.0006914070066095235},
{"x":80,"v1":0.0013231635489674431},
{"x":81,"v1":0.0005318320702825119},
{"x":82,"v1":-0.00047366025888173624},
{"x":83,"v1":-0.0005741987962490924},
{"x":84,"v1":-0.002512162271711027},
{"x":85,"v1":-0.0004248089900356078},
{"x":86,"v1":0.0014169724502002268},
{"x":87,"v1":0.0004120012275965479},
{"x":88,"v1":0.0004891825608819289},
{"x":89,"v1":-2.7411708458657813e-5},
{"x":90,"v1":0.0005385741560486323},
{"x":91,"v1":0.0008395068776723136},
{"x":92,"v1":0.0010183997428567793},
{"x":93,"v1":-0.0025015191979695928},
{"x":94,"v1":-0.0026574415852476108},
{"x":95,"v1":0.002706948569853651},
{"x":96,"v1":-0.001398234344620164},
{"x":97,"v1":0.0020574512823081648},
{"x":98,"v1":-0.0009018327265852832},
{"x":99,"v1":0.0018533685082262608},
{"x":100,"v1":-0.000717174228348938}];
    const series = [{"name":"Smoothed var 3","color":"#2ca02c","key":"v1","dash":""}];
    const bands = [];
    const refLines = [];

    const container = d3.select('#nc_var_99');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Period') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Period');
    if('') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"v1":-0.002247090088921766},
{"x":2,"v1":0.002593514792261331},
{"x":3,"v1":0.0001433715207692643},
{"x":4,"v1":-0.0008054505176726678},
{"x":5,"v1":0.0007787597541746294},
{"x":6,"v1":-0.0019493860098460658},
{"x":7,"v1":0.00189193077383365},
{"x":8,"v1":-0.0035772204672124275},
{"x":9,"v1":0.0019196249802959642},
{"x":10,"v1":0.00147550296532728},
{"x":11,"v1":-0.0027924833863171017},
{"x":12,"v1":0.002692496055033189},
{"x":13,"v1":0.00031035197380724355},
{"x":14,"v1":-0.001861882267977677},
{"x":15,"v1":0.0010867914371299747},
{"x":16,"v1":-0.0010097183942008314},
{"x":17,"v1":-0.0016550179036318724},
{"x":18,"v1":0.0005183405418218712},
{"x":19,"v1":0.00714347909165447},
{"x":20,"v1":-0.0041062978369286185},
{"x":21,"v1":-0.0019716669168410306},
{"x":22,"v1":0.0006827872709322946},
{"x":23,"v1":-0.001163280098003483},
{"x":24,"v1":0.004750884355033236},
{"x":25,"v1":0.0013917209824203525},
{"x":26,"v1":-0.002546155529023153},
{"x":27,"v1":-9.081548355460711e-5},
{"x":28,"v1":0.001002171221118786},
{"x":29,"v1":0.00254653228431323},
{"x":30,"v1":-0.0018069545349881366},
{"x":31,"v1":-0.0025437759679007854},
{"x":32,"v1":-0.00018367492561921495},
{"x":33,"v1":-0.0012088122199607199},
{"x":34,"v1":0.03023580794198999},
{"x":35,"v1":0.027861526609370912},
{"x":36,"v1":-0.012719784197900097},
{"x":37,"v1":-0.03264845914041459},
{"x":38,"v1":-0.007363711525799843},
{"x":39,"v1":-0.005000545753143015},
{"x":40,"v1":0.008948038869895925},
{"x":41,"v1":-0.004285938027168257},
{"x":42,"v1":0.0037910146340198736},
{"x":43,"v1":-0.003988661253661263},
{"x":44,"v1":0.0036819050223062533},
{"x":45,"v1":0.00039906162770542153},
{"x":46,"v1":-0.0006657337082103254},
{"x":47,"v1":0.005419886164508725},
{"x":48,"v1":-0.0036629444730493788},
{"x":49,"v1":-0.01119064837412509},
{"x":50,"v1":0.005488727922026371},
{"x":51,"v1":0.0012704151850737588},
{"x":52,"v1":-0.0007872206706451834},
{"x":53,"v1":-0.0002958667442776175},
{"x":54,"v1":0.00046603847841097945},
{"x":55,"v1":-0.000993268322284635},
{"x":56,"v1":-0.0018058280680044447},
{"x":57,"v1":-0.0009049265405032259},
{"x":58,"v1":-0.0028291744915218686},
{"x":59,"v1":-0.00035676856117206057},
{"x":60,"v1":-0.00405057186953961},
{"x":61,"v1":0.0005240191151401064},
{"x":62,"v1":0.00215069419277647},
{"x":63,"v1":-0.0015631103685134207},
{"x":64,"v1":-0.0023649851135871813},
{"x":65,"v1":-0.0005059074455324719},
{"x":66,"v1":0.001390049300017182},
{"x":67,"v1":-0.003434651503237518},
{"x":68,"v1":0.005892911605043238},
{"x":69,"v1":-0.00033550271120219577},
{"x":70,"v1":-0.013697615846995248},
{"x":71,"v1":0.007636749659479136},
{"x":72,"v1":0.010475924757816557},
{"x":73,"v1":-0.004323375427592424},
{"x":74,"v1":0.00036997619019629724},
{"x":75,"v1":-0.0006941041806349801},
{"x":76,"v1":-6.420149449759549e-5},
{"x":77,"v1":-0.0003254395343628147},
{"x":78,"v1":0.0020578403990789695},
{"x":79,"v1":-0.00024171108129422691},
{"x":80,"v1":0.0032497772049531193},
{"x":81,"v1":0.0007648757055314093},
{"x":82,"v1":-0.0023356098411948523},
{"x":83,"v1":-0.0005529129620693851},
{"x":84,"v1":0.0015477758150890253},
{"x":85,"v1":0.00012467032928498156},
{"x":86,"v1":-0.001539849363846102},
{"x":87,"v1":0.0026369721840495686},
{"x":88,"v1":-4.036914434557559e-5},
{"x":89,"v1":-0.0016952223207642447},
{"x":90,"v1":0.002295222828216481},
{"x":91,"v1":-0.0038976164624511256},
{"x":92,"v1":0.002393795873087967},
{"x":93,"v1":0.00018940862549143844},
{"x":94,"v1":-2.5105736101593834e-5},
{"x":95,"v1":0.002836247366197142},
{"x":96,"v1":-0.003559265334713402},
{"x":97,"v1":0.002639976416419998},
{"x":98,"v1":-0.0013339578092992355},
{"x":99,"v1":-0.00030924226663664456},
{"x":100,"v1":0.0010726295300074185}];
    const series = [{"name":"Smoothed var 4","color":"#d62728","key":"v1","dash":""}];
    const bands = [];
    const refLines = [];

    const container = d3.select('#nc_var_100');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Period') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Period');
    if('') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>