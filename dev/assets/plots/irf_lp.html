<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LP Impulse Responses (newey_west, 95% CI)</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(33% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">LP Impulse Responses (newey_west, 95% CI)</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">Var 1 ← Shock 1</div>
<div id="lpirf_28"></div>
</div>
<div class="panel">
<div class="panel-title">Var 2 ← Shock 1</div>
<div id="lpirf_29"></div>
</div>
<div class="panel">
<div class="panel-title">Var 3 ← Shock 1</div>
<div id="lpirf_30"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":0,"irf":1.0,"ci_lo":1.0,"ci_hi":1.0,"zero":0},
{"x":1,"irf":0.2711357172687639,"ci_lo":0.11078694078799278,"ci_hi":0.431484493749535,"zero":0},
{"x":2,"irf":-0.011448809058728762,"ci_lo":-0.2663618373053466,"ci_hi":0.24346421918788913,"zero":0},
{"x":3,"irf":0.035456382624029274,"ci_lo":-0.17601569696090927,"ci_hi":0.24692846220896783,"zero":0},
{"x":4,"irf":0.05735632399914268,"ci_lo":-0.06730287971603549,"ci_hi":0.18201552771432086,"zero":0},
{"x":5,"irf":-0.011810933589629424,"ci_lo":-0.10065242788681047,"ci_hi":0.07703056070755163,"zero":0},
{"x":6,"irf":0.02897202133057605,"ci_lo":-0.04765895189582772,"ci_hi":0.10560299455697983,"zero":0},
{"x":7,"irf":0.046308022729727304,"ci_lo":-0.026779695055581358,"ci_hi":0.11939574051503596,"zero":0},
{"x":8,"irf":-0.017146995715600154,"ci_lo":-0.09258079909046868,"ci_hi":0.058286807659268365,"zero":0},
{"x":9,"irf":0.024038880385675337,"ci_lo":-0.0650220014910179,"ci_hi":0.11309976226236858,"zero":0},
{"x":10,"irf":0.12139563809945378,"ci_lo":0.04049887122359497,"ci_hi":0.2022924049753126,"zero":0},
{"x":11,"irf":-0.010132907855933376,"ci_lo":-0.0879745925729013,"ci_hi":0.06770877686103455,"zero":0},
{"x":12,"irf":-0.038323789743194135,"ci_lo":-0.10270448965369974,"ci_hi":0.026056910167311466,"zero":0},
{"x":13,"irf":-0.020712929258794463,"ci_lo":-0.07079241630556957,"ci_hi":0.029366557787980647,"zero":0},
{"x":14,"irf":-0.02333070862862999,"ci_lo":-0.07520115291750515,"ci_hi":0.028539735660245164,"zero":0},
{"x":15,"irf":-0.010790571063424136,"ci_lo":-0.06453579705286443,"ci_hi":0.04295465492601616,"zero":0},
{"x":16,"irf":0.01387066586500479,"ci_lo":-0.048781790165979735,"ci_hi":0.07652312189598932,"zero":0},
{"x":17,"irf":0.016374199249824327,"ci_lo":-0.04574654508361475,"ci_hi":0.0784949435832634,"zero":0},
{"x":18,"irf":-0.0032181524193566537,"ci_lo":-0.06839360740564931,"ci_hi":0.06195730256693601,"zero":0},
{"x":19,"irf":-0.025749301452119986,"ci_lo":-0.07727165299606316,"ci_hi":0.025773050091823183,"zero":0},
{"x":20,"irf":-0.028417607265344855,"ci_lo":-0.08548316034468609,"ci_hi":0.02864794581399638,"zero":0}];
    const series = [{"name":"LP-IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#lpirf_28');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":-26.71272162866675,"ci_lo":-51.28696474526201,"ci_hi":-2.138478512071483,"zero":0},
{"x":1,"irf":-9.263300212144227,"ci_lo":-15.491806047861392,"ci_hi":-3.034794376427061,"zero":0},
{"x":2,"irf":1.3097815592147843,"ci_lo":-8.608861328020769,"ci_hi":11.228424446450337,"zero":0},
{"x":3,"irf":-1.6661990908351494,"ci_lo":-6.588514300610722,"ci_hi":3.2561161189404237,"zero":0},
{"x":4,"irf":-0.46136351420486804,"ci_lo":-7.49171354043912,"ci_hi":6.568986512029383,"zero":0},
{"x":5,"irf":0.5430178516922636,"ci_lo":-4.6385891911362425,"ci_hi":5.724624894520769,"zero":0},
{"x":6,"irf":-0.5577251064180629,"ci_lo":-5.175589651475482,"ci_hi":4.0601394386393554,"zero":0},
{"x":7,"irf":-1.0115017587241253,"ci_lo":-3.4893463894821184,"ci_hi":1.4663428720338678,"zero":0},
{"x":8,"irf":-0.4324521345010286,"ci_lo":-3.8702510424663585,"ci_hi":3.0053467734643013,"zero":0},
{"x":9,"irf":-1.2066655244580677,"ci_lo":-3.451062326271861,"ci_hi":1.0377312773557255,"zero":0},
{"x":10,"irf":-0.49722603753969447,"ci_lo":-2.5330587262203323,"ci_hi":1.5386066511409435,"zero":0},
{"x":11,"irf":-0.1640493454543315,"ci_lo":-2.1295188240270324,"ci_hi":1.8014201331183692,"zero":0},
{"x":12,"irf":-1.2928264417739,"ci_lo":-3.750537423678651,"ci_hi":1.164884540130851,"zero":0},
{"x":13,"irf":0.08014247960795995,"ci_lo":-1.457544534435963,"ci_hi":1.6178294936518829,"zero":0},
{"x":14,"irf":-1.4054579044345674,"ci_lo":-3.25564800146232,"ci_hi":0.44473219259318486,"zero":0},
{"x":15,"irf":0.4648604421147405,"ci_lo":-2.126757740202567,"ci_hi":3.056478624432048,"zero":0},
{"x":16,"irf":0.740624452329086,"ci_lo":-0.9830533922887831,"ci_hi":2.464302296946955,"zero":0},
{"x":17,"irf":0.8730500268332076,"ci_lo":-0.5777055424611431,"ci_hi":2.3238055961275585,"zero":0},
{"x":18,"irf":-0.010675985639173654,"ci_lo":-1.6202839990462383,"ci_hi":1.5989320277678911,"zero":0},
{"x":19,"irf":0.5296428847498564,"ci_lo":-1.2527469238699687,"ci_hi":2.3120326933696815,"zero":0},
{"x":20,"irf":1.0273215292154778,"ci_lo":-1.4159423581715442,"ci_hi":3.4705854166025,"zero":0}];
    const series = [{"name":"LP-IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#lpirf_29');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":0.026508948185684705,"ci_lo":0.002494181135111063,"ci_hi":0.05052371523625834,"zero":0},
{"x":1,"irf":-0.006543584713869885,"ci_lo":-0.027561849178061704,"ci_hi":0.014474679750321934,"zero":0},
{"x":2,"irf":0.0005272298579006576,"ci_lo":-0.036618379039563116,"ci_hi":0.03767283875536443,"zero":0},
{"x":3,"irf":0.008183302452973353,"ci_lo":-0.010971240947847037,"ci_hi":0.027337845853793744,"zero":0},
{"x":4,"irf":-0.004489300603327523,"ci_lo":-0.026350901428130083,"ci_hi":0.017372300221475033,"zero":0},
{"x":5,"irf":-0.011365063300785551,"ci_lo":-0.03359365355358778,"ci_hi":0.010863526952016679,"zero":0},
{"x":6,"irf":0.006072528644607681,"ci_lo":-0.009367995509893805,"ci_hi":0.02151305279910917,"zero":0},
{"x":7,"irf":0.0010297615343254046,"ci_lo":-0.015021510145885649,"ci_hi":0.017081033214536457,"zero":0},
{"x":8,"irf":-0.003273061129062841,"ci_lo":-0.02279956340286277,"ci_hi":0.016253441144737087,"zero":0},
{"x":9,"irf":-0.012996708772417223,"ci_lo":-0.03659039022172132,"ci_hi":0.010596972676886873,"zero":0},
{"x":10,"irf":0.01446265245765453,"ci_lo":-0.004805840137467163,"ci_hi":0.033731145052776225,"zero":0},
{"x":11,"irf":0.007826027635532952,"ci_lo":-0.010543586059266911,"ci_hi":0.026195641330332815,"zero":0},
{"x":12,"irf":0.004705573953245108,"ci_lo":-0.01391429613679548,"ci_hi":0.0233254440432857,"zero":0},
{"x":13,"irf":-0.006146943882235394,"ci_lo":-0.02377246511436835,"ci_hi":0.011478577349897563,"zero":0},
{"x":14,"irf":-0.005876472710998587,"ci_lo":-0.024276300304595533,"ci_hi":0.01252335488259836,"zero":0},
{"x":15,"irf":-0.0003485434828571807,"ci_lo":-0.023159550576575115,"ci_hi":0.022462463610860753,"zero":0},
{"x":16,"irf":-0.001022435321256599,"ci_lo":-0.023456917126501865,"ci_hi":0.021412046483988666,"zero":0},
{"x":17,"irf":0.012862828141063544,"ci_lo":-0.005309446226737244,"ci_hi":0.031035102508864335,"zero":0},
{"x":18,"irf":-0.009116680362588026,"ci_lo":-0.028321584410422013,"ci_hi":0.01008822368524596,"zero":0},
{"x":19,"irf":0.001116410088176177,"ci_lo":-0.017038903669133437,"ci_hi":0.01927172384548579,"zero":0},
{"x":20,"irf":-0.007439505703464103,"ci_lo":-0.022857809301641732,"ci_hi":0.007978797894713528,"zero":0}];
    const series = [{"name":"LP-IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#lpirf_30');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>