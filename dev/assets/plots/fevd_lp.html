<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LP-FEVD (bias-corrected)</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(33% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">LP-FEVD (bias-corrected)</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">y1</div>
<div id="lpfevd_46"></div>
</div>
<div class="panel">
<div class="panel-title">y2</div>
<div id="lpfevd_47"></div>
</div>
<div class="panel">
<div class="panel-title">y3</div>
<div id="lpfevd_48"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":1,"s1":1.0,"s2":0.0,"s3":0.0},
{"x":2,"s1":0.9785534579073168,"s2":0.006024860808587932,"s3":0.015421681284095191},
{"x":3,"s1":0.9350684525715239,"s2":0.05056439260644723,"s3":0.014367154822028758},
{"x":4,"s1":0.912277973588435,"s2":0.07454634562120138,"s3":0.013175680790363546},
{"x":5,"s1":0.9015494499281178,"s2":0.0843974023515873,"s3":0.014053147720294869},
{"x":6,"s1":0.9011331510878007,"s2":0.08595916255945427,"s3":0.012907686352744958},
{"x":7,"s1":0.8999598755184383,"s2":0.08871291982292352,"s3":0.011327204658638198},
{"x":8,"s1":0.9008121591846392,"s2":0.08940824139615194,"s3":0.009779599419208732},
{"x":9,"s1":0.8988153245202524,"s2":0.0928092329397273,"s3":0.008375442540020305},
{"x":10,"s1":0.904258210248324,"s2":0.08906806053426998,"s3":0.006673729217406031},
{"x":11,"s1":0.901188694502601,"s2":0.09031268556241738,"s3":0.008498619934981575},
{"x":12,"s1":0.8984089970370684,"s2":0.09294405243997457,"s3":0.008646950522957022},
{"x":13,"s1":0.8930338529601005,"s2":0.09121966491118659,"s3":0.015746482128712883},
{"x":14,"s1":0.8900886151202333,"s2":0.09285017491477335,"s3":0.017061209964993395},
{"x":15,"s1":0.8908832602456558,"s2":0.09306067463576415,"s3":0.016056065118579908},
{"x":16,"s1":0.8880203029231294,"s2":0.09317178827575567,"s3":0.018807908801114864},
{"x":17,"s1":0.8898768447828128,"s2":0.09142968488577613,"s3":0.01869347033141102},
{"x":18,"s1":0.8862406231345423,"s2":0.09168414180101461,"s3":0.022075235064443078},
{"x":19,"s1":0.8762504300902062,"s2":0.09797568727257654,"s3":0.025773882637217263},
{"x":20,"s1":0.8726423210567981,"s2":0.10077049020048635,"s3":0.0265871887427157}];
    const series = [{"name":"y1","color":"#1f77b4","key":"s1","dash":""},{"name":"y2","color":"#ff7f0e","key":"s2","dash":""},{"name":"y3","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#lpfevd_46');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"s1":0.3610899087068712,"s2":0.6389100912931288,"s3":0.0},
{"x":2,"s1":0.3726833175539239,"s2":0.6221612472298257,"s3":0.005155435216250451},
{"x":3,"s1":0.36989996152535287,"s2":0.624791037622504,"s3":0.0053090008521432},
{"x":4,"s1":0.377777817629229,"s2":0.6177366459381206,"s3":0.004485536432650379},
{"x":5,"s1":0.3735259069619026,"s2":0.6217519368592808,"s3":0.004722156178816679},
{"x":6,"s1":0.3757678327896766,"s2":0.6202129711729563,"s3":0.004019196037366958},
{"x":7,"s1":0.3786453199494596,"s2":0.61919807374114,"s3":0.002156606309400257},
{"x":8,"s1":0.37975062324249254,"s2":0.6196134379489214,"s3":0.0006359388085860876},
{"x":9,"s1":0.3807144369768319,"s2":0.6192855630231681,"s3":0.0},
{"x":10,"s1":0.3832549737991809,"s2":0.6167450262008192,"s3":0.0},
{"x":11,"s1":0.38126890790177714,"s2":0.6187310920982229,"s3":0.0},
{"x":12,"s1":0.38334863857732565,"s2":0.6166513614226743,"s3":0.0},
{"x":13,"s1":0.38402378613404115,"s2":0.6159762138659588,"s3":0.0},
{"x":14,"s1":0.38114987219569574,"s2":0.6188501278043043,"s3":0.0},
{"x":15,"s1":0.37931800568696394,"s2":0.6206819943130361,"s3":0.0},
{"x":16,"s1":0.3789984452575929,"s2":0.621001554742407,"s3":0.0},
{"x":17,"s1":0.37845998681739457,"s2":0.6215400131826055,"s3":0.0},
{"x":18,"s1":0.3781746182062749,"s2":0.6218253817937253,"s3":0.0},
{"x":19,"s1":0.37668010679210046,"s2":0.6233198932078996,"s3":0.0},
{"x":20,"s1":0.37712822329210804,"s2":0.6228717767078918,"s3":0.0}];
    const series = [{"name":"y1","color":"#1f77b4","key":"s1","dash":""},{"name":"y2","color":"#ff7f0e","key":"s2","dash":""},{"name":"y3","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#lpfevd_47');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"s1":0.010209848581494138,"s2":0.005801001749914621,"s3":0.9839891496685913},
{"x":2,"s1":0.006451897068418098,"s2":0.008717150043145099,"s3":0.9848309528884368},
{"x":3,"s1":0.004840491716898334,"s2":0.013856891300363196,"s3":0.9813026169827385},
{"x":4,"s1":0.005436893678792283,"s2":0.011608632522018755,"s3":0.982954473799189},
{"x":5,"s1":0.003474391338525062,"s2":0.009978044033780996,"s3":0.9865475646276939},
{"x":6,"s1":0.0042518051147953555,"s2":0.012578572520744102,"s3":0.9831696223644606},
{"x":7,"s1":0.003146668610068453,"s2":0.009838647717043951,"s3":0.9870146836728876},
{"x":8,"s1":0.0009655492376811354,"s2":0.007800075961581321,"s3":0.9912343748007376},
{"x":9,"s1":0.0007108175080929605,"s2":0.007549057956178497,"s3":0.9917401245357286},
{"x":10,"s1":0.0006807109514633909,"s2":0.008850020053352003,"s3":0.9904692689951846},
{"x":11,"s1":0.0013837656122832622,"s2":0.01010091550492288,"s3":0.9885153188827939},
{"x":12,"s1":0.0006819309696754969,"s2":0.012966404124466441,"s3":0.986351664905858},
{"x":13,"s1":0.0004887176821480542,"s2":0.01649697998767232,"s3":0.9830143023301796},
{"x":14,"s1":0.0012544950543708767,"s2":0.018161135331932397,"s3":0.9805843696136968},
{"x":15,"s1":0.0,"s2":0.020106451294032976,"s3":0.979893548705967},
{"x":16,"s1":0.0,"s2":0.02284488122726385,"s3":0.9771551187727362},
{"x":17,"s1":0.0,"s2":0.022391376111893565,"s3":0.9776086238881064},
{"x":18,"s1":0.0,"s2":0.022002581859262328,"s3":0.9779974181407376},
{"x":19,"s1":0.0,"s2":0.023255097106412246,"s3":0.9767449028935877},
{"x":20,"s1":0.0,"s2":0.023071831728807782,"s3":0.9769281682711922}];
    const series = [{"name":"y1","color":"#1f77b4","key":"s1","dash":""},{"name":"y2","color":"#ff7f0e","key":"s2","dash":""},{"name":"y3","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#lpfevd_48');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>