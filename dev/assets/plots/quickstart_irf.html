<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Impulse Response Functions (bootstrap CI)</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(33% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">Impulse Response Functions (bootstrap CI)</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">y1 ← y1</div>
<div id="irf_1"></div>
</div>
<div class="panel">
<div class="panel-title">y2 ← y1</div>
<div id="irf_2"></div>
</div>
<div class="panel">
<div class="panel-title">y3 ← y1</div>
<div id="irf_3"></div>
</div>
<div class="panel">
<div class="panel-title">y1 ← y2</div>
<div id="irf_4"></div>
</div>
<div class="panel">
<div class="panel-title">y2 ← y2</div>
<div id="irf_5"></div>
</div>
<div class="panel">
<div class="panel-title">y3 ← y2</div>
<div id="irf_6"></div>
</div>
<div class="panel">
<div class="panel-title">y1 ← y3</div>
<div id="irf_7"></div>
</div>
<div class="panel">
<div class="panel-title">y2 ← y3</div>
<div id="irf_8"></div>
</div>
<div class="panel">
<div class="panel-title">y3 ← y3</div>
<div id="irf_9"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":0,"irf":0.009142252715281478,"ci_lo":0.007324436276998834,"ci_hi":0.011412823217050713,"zero":0},
{"x":1,"irf":0.0024973048441385005,"ci_lo":0.001830569484582697,"ci_hi":0.003215274699999214,"zero":0},
{"x":2,"irf":-9.721237640622729e-5,"ci_lo":-0.0015449465479545313,"ci_hi":0.0011116036462791136,"zero":0},
{"x":3,"irf":0.0002782709337641937,"ci_lo":-0.0006885066035041752,"ci_hi":0.0011675510405960822,"zero":0},
{"x":4,"irf":0.0005267363961280265,"ci_lo":-9.770202873231099e-5,"ci_hi":0.001131392126835486,"zero":0},
{"x":5,"irf":9.856176080811342e-5,"ci_lo":-0.00029992547944206226,"ci_hi":0.0004658435046775748,"zero":0},
{"x":6,"irf":-6.390348572086998e-6,"ci_lo":-0.00021037896235586638,"ci_hi":0.00020622875877354349,"zero":0},
{"x":7,"irf":4.360141374393358e-5,"ci_lo":-0.00014142808729434447,"ci_hi":0.00022188235094083305,"zero":0},
{"x":8,"irf":4.7268563211616866e-5,"ci_lo":-8.46207911435256e-5,"ci_hi":0.00017568353212842907,"zero":0},
{"x":9,"irf":2.0142633005462227e-5,"ci_lo":-3.0045053104901364e-5,"ci_hi":9.452044518564416e-5,"zero":0},
{"x":10,"irf":1.6376740938930691e-6,"ci_lo":-2.71419895423723e-5,"ci_hi":5.410232700944845e-5,"zero":0},
{"x":11,"irf":5.664369740367629e-7,"ci_lo":-2.2894288156315827e-5,"ci_hi":3.171428369352329e-5,"zero":0},
{"x":12,"irf":1.2074513244225614e-6,"ci_lo":-1.0393717018204214e-5,"ci_hi":2.6605172866765058e-5,"zero":0},
{"x":13,"irf":1.786799478317024e-6,"ci_lo":-5.509267499656853e-6,"ci_hi":2.0500839595939997e-5,"zero":0},
{"x":14,"irf":1.4895569571766774e-6,"ci_lo":-3.007970509343013e-6,"ci_hi":1.2904806128249227e-5,"zero":0},
{"x":15,"irf":2.600391594404404e-7,"ci_lo":-3.3744921724033537e-6,"ci_hi":7.823184797159721e-6,"zero":0},
{"x":16,"irf":-2.9348951051608456e-7,"ci_lo":-2.6415336417730645e-6,"ci_hi":4.92884026589485e-6,"zero":0},
{"x":17,"irf":-1.1641059842605976e-7,"ci_lo":-2.2480490035310565e-6,"ci_hi":3.1948393000709756e-6,"zero":0},
{"x":18,"irf":2.0837960318688708e-7,"ci_lo":-1.400554234372453e-6,"ci_hi":2.7669186534021996e-6,"zero":0},
{"x":19,"irf":2.0199177826662965e-7,"ci_lo":-5.946529897377244e-7,"ci_hi":1.8717907157685277e-6,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_1');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":-0.2442144518422368,"ci_lo":-0.49838181512568225,"ci_hi":-0.06558356466882936,"zero":0},
{"x":1,"irf":-0.08521315387620655,"ci_lo":-0.11636149348430774,"ci_hi":-0.04531903993853455,"zero":0},
{"x":2,"irf":0.010227117259098476,"ci_lo":-0.02253779704250527,"ci_hi":0.06141496187345329,"zero":0},
{"x":3,"irf":-0.019836689957342793,"ci_lo":-0.043158848424964626,"ci_hi":0.00813557865057574,"zero":0},
{"x":4,"irf":-0.00983286357648428,"ci_lo":-0.04036166935693984,"ci_hi":0.03186489966607013,"zero":0},
{"x":5,"irf":0.0002561473907561387,"ci_lo":-0.012176855008512559,"ci_hi":0.012899053566641991,"zero":0},
{"x":6,"irf":-0.0013601963464266083,"ci_lo":-0.008782460797894194,"ci_hi":0.005519207191014303,"zero":0},
{"x":7,"irf":8.644081930239738e-5,"ci_lo":-0.00539575154547721,"ci_hi":0.005625534813622391,"zero":0},
{"x":8,"irf":-0.0016579432651624964,"ci_lo":-0.006159752441263676,"ci_hi":0.0038080681632026063,"zero":0},
{"x":9,"irf":-0.000907822043396078,"ci_lo":-0.003434069523195711,"ci_hi":0.001140641233421968,"zero":0},
{"x":10,"irf":0.00011531685432724315,"ci_lo":-0.0013921729775740995,"ci_hi":0.0014801791827341107,"zero":0},
{"x":11,"irf":-5.107824737162702e-5,"ci_lo":-0.0009787220163705152,"ci_hi":0.0009697844999455088,"zero":0},
{"x":12,"irf":3.991697423144198e-5,"ci_lo":-0.0007783555027776128,"ci_hi":0.0006509365627757461,"zero":0},
{"x":13,"irf":-4.723995533423128e-5,"ci_lo":-0.0006174586914111573,"ci_hi":0.00037589660306767926,"zero":0},
{"x":14,"irf":-8.493753762228522e-5,"ci_lo":-0.00041287090733244797,"ci_hi":0.0001256403290162391,"zero":0},
{"x":15,"irf":1.8382219102973802e-6,"ci_lo":-0.000249737080599844,"ci_hi":0.00019631018068554004,"zero":0},
{"x":16,"irf":1.7459756324334253e-5,"ci_lo":-0.00013925338463364163,"ci_hi":0.00011797944058777803,"zero":0},
{"x":17,"irf":6.833807559569604e-6,"ci_lo":-0.00010891399781974201,"ci_hi":0.00010036829595706475,"zero":0},
{"x":18,"irf":-6.7060726490730806e-6,"ci_lo":-8.55442016537434e-5,"ci_hi":6.0275879419480896e-5,"zero":0},
{"x":19,"irf":-1.051564907298853e-5,"ci_lo":-6.877981916858061e-5,"ci_hi":2.5266365047353357e-5,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_2');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":0.00024235150352983203,"ci_lo":-7.859823859732272e-7,"ci_hi":0.000445907723478281,"zero":0},
{"x":1,"irf":-7.447095820759568e-5,"ci_lo":-0.0002730014418659052,"ci_hi":0.0001161049134079377,"zero":0},
{"x":2,"irf":-2.294163652023027e-5,"ci_lo":-0.00025579838570284505,"ci_hi":0.0002101959451163788,"zero":0},
{"x":3,"irf":6.200894876975149e-5,"ci_lo":-0.00013310153678661085,"ci_hi":0.00024945054070460985,"zero":0},
{"x":4,"irf":-0.00010226855197416156,"ci_lo":-0.00026736401747233355,"ci_hi":7.698161484383951e-5,"zero":0},
{"x":5,"irf":1.1840917750519564e-5,"ci_lo":-7.010760509301702e-5,"ci_hi":8.5744205780983e-5,"zero":0},
{"x":6,"irf":2.338404631906834e-5,"ci_lo":-3.980302311055188e-5,"ci_hi":8.401856065873798e-5,"zero":0},
{"x":7,"irf":1.2926479529932543e-5,"ci_lo":-2.3142643298306663e-5,"ci_hi":5.7235482338903536e-5,"zero":0},
{"x":8,"irf":-6.7784459410004725e-6,"ci_lo":-4.1082416858209386e-5,"ci_hi":2.349588300970787e-5,"zero":0},
{"x":9,"irf":-1.1282990612233012e-5,"ci_lo":-3.466225225941651e-5,"ci_hi":9.188252307540665e-6,"zero":0},
{"x":10,"irf":1.0781235025501964e-6,"ci_lo":-1.2752928739789924e-5,"ci_hi":1.3366756613415862e-5,"zero":0},
{"x":11,"irf":3.840890165378966e-6,"ci_lo":-5.288545282815627e-6,"ci_hi":1.4801568454968084e-5,"zero":0},
{"x":12,"irf":2.017952797381028e-6,"ci_lo":-3.6257734327497e-6,"ci_hi":9.787676427468672e-6,"zero":0},
{"x":13,"irf":-1.1831373575040228e-6,"ci_lo":-7.186128166388769e-6,"ci_hi":4.229519403722289e-6,"zero":0},
{"x":14,"irf":-1.538048210521512e-6,"ci_lo":-6.367826526015241e-6,"ci_hi":1.3292941921941072e-6,"zero":0},
{"x":15,"irf":-8.518642987714396e-9,"ci_lo":-2.6051709444215477e-6,"ci_hi":2.287066893091093e-6,"zero":0},
{"x":16,"irf":6.45329233915623e-7,"ci_lo":-1.1229054017479994e-6,"ci_hi":3.2626092013502614e-6,"zero":0},
{"x":17,"irf":3.497492028236526e-7,"ci_lo":-6.821878279213042e-7,"ci_hi":2.0835447918564545e-6,"zero":0},
{"x":18,"irf":-1.7921957001308405e-7,"ci_lo":-1.2470200405384569e-6,"ci_hi":8.523342865870277e-7,"zero":0},
{"x":19,"irf":-2.494001899748151e-7,"ci_lo":-1.3272067753966192e-6,"ci_hi":2.882362087200501e-7,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_3');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":0.0,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":1,"irf":0.0007793420698751627,"ci_lo":-5.8642043766975204e-5,"ci_hi":0.0014609097175131388,"zero":0},
{"x":2,"irf":0.0018182907107299328,"ci_lo":0.0006670797585511022,"ci_hi":0.0027493296604372375,"zero":0},
{"x":3,"irf":0.001319325408562708,"ci_lo":0.000293497140558471,"ci_hi":0.0021941443801464164,"zero":0},
{"x":4,"irf":0.0005391923014313401,"ci_lo":-0.00013226152045356612,"ci_hi":0.0011731005829003767,"zero":0},
{"x":5,"irf":0.00011160694498500202,"ci_lo":-0.00013553262271782582,"ci_hi":0.0003510231667555604,"zero":0},
{"x":6,"irf":1.112680224399523e-5,"ci_lo":-0.00019783003871658996,"ci_hi":0.0002470123820783074,"zero":0},
{"x":7,"irf":-7.123061268328343e-6,"ci_lo":-0.0001645329477136979,"ci_hi":0.00014992558512177544,"zero":0},
{"x":8,"irf":1.7730239728885458e-6,"ci_lo":-9.275105406325613e-5,"ci_hi":0.00010544013747934253,"zero":0},
{"x":9,"irf":2.026289810801665e-5,"ci_lo":-4.908412908306962e-5,"ci_hi":9.718846425119468e-5,"zero":0},
{"x":10,"irf":1.7487723914533716e-5,"ci_lo":-1.8276232720493578e-5,"ci_hi":7.0151833385808e-5,"zero":0},
{"x":11,"irf":6.190938303937534e-6,"ci_lo":-1.8316894003948425e-5,"ci_hi":4.056645050038552e-5,"zero":0},
{"x":12,"irf":3.7893767908806885e-8,"ci_lo":-1.636212039111747e-5,"ci_hi":1.741526286489258e-5,"zero":0},
{"x":13,"irf":-3.475191002941278e-8,"ci_lo":-1.0133899935161957e-5,"ci_hi":1.3050079340050706e-5,"zero":0},
{"x":14,"irf":1.3180314371820053e-6,"ci_lo":-4.963945026705797e-6,"ci_hi":1.1379062927649129e-5,"zero":0},
{"x":15,"irf":9.502638831803924e-7,"ci_lo":-2.203070277599746e-6,"ci_hi":7.936404750025772e-6,"zero":0},
{"x":16,"irf":-3.9539507975454756e-8,"ci_lo":-2.70022816606092e-6,"ci_hi":4.770254227770226e-6,"zero":0},
{"x":17,"irf":-3.4139205439420035e-7,"ci_lo":-2.413527429146547e-6,"ci_hi":2.514763127629055e-6,"zero":0},
{"x":18,"irf":-5.4667678558963706e-8,"ci_lo":-1.4527316780359693e-6,"ci_hi":2.2149286734396507e-6,"zero":0},
{"x":19,"irf":2.0439297862551948e-7,"ci_lo":-6.741729442256782e-7,"ci_hi":1.832530764374608e-6,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_4');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":0.32394195511143004,"ci_lo":0.17575166526725683,"ci_hi":0.42963586428727074,"zero":0},
{"x":1,"irf":-0.06574941404188687,"ci_lo":-0.10338345422151737,"ci_hi":-0.025775387077854442,"zero":0},
{"x":2,"irf":-0.05141664295685253,"ci_lo":-0.08530420680287962,"ci_hi":-0.01627719531728047,"zero":0},
{"x":3,"irf":-0.023715301485516684,"ci_lo":-0.05446379569905847,"ci_hi":0.0020395269644906287,"zero":0},
{"x":4,"irf":-0.04418897106413663,"ci_lo":-0.07407482252980581,"ci_hi":-0.013628958827574254,"zero":0},
{"x":5,"irf":0.0013074101556106081,"ci_lo":-0.00920522625386883,"ci_hi":0.01319710578093098,"zero":0},
{"x":6,"irf":0.0009369133754642362,"ci_lo":-0.006455456068879999,"ci_hi":0.009551048108014819,"zero":0},
{"x":7,"irf":-0.0010283213522770244,"ci_lo":-0.008637214585329933,"ci_hi":0.0071182334889340615,"zero":0},
{"x":8,"irf":0.0027842858529827093,"ci_lo":-0.0025200505889497807,"ci_hi":0.008621295021482277,"zero":0},
{"x":9,"irf":-0.0012519276362337344,"ci_lo":-0.004085827125290565,"ci_hi":0.000966925756461735,"zero":0},
{"x":10,"irf":-0.000765530969707082,"ci_lo":-0.0027415084403040312,"ci_hi":0.0007418882238313205,"zero":0},
{"x":11,"irf":8.23956327983421e-5,"ci_lo":-0.0014952005116657323,"ci_hi":0.0015190271221892275,"zero":0},
{"x":12,"irf":-0.00019238992261694875,"ci_lo":-0.0012799227749839747,"ci_hi":0.0005853370956233996,"zero":0},
{"x":13,"irf":8.068673752190804e-5,"ci_lo":-0.00043358768195559,"ci_hi":0.000784357381271061,"zero":0},
{"x":14,"irf":-2.9522292652708646e-5,"ci_lo":-0.0003478071571102766,"ci_hi":0.00029225375473994743,"zero":0},
{"x":15,"irf":-7.585456020966081e-5,"ci_lo":-0.00038181084330942805,"ci_hi":9.622567113513775e-5,"zero":0},
{"x":16,"irf":2.5892374494935227e-5,"ci_lo":-0.00014985749381339766,"ci_hi":0.00020966082316911381,"zero":0},
{"x":17,"irf":1.439676285978202e-5,"ci_lo":-0.0001269991909072395,"ci_hi":0.00012505788945590534,"zero":0},
{"x":18,"irf":2.6213859474484497e-6,"ci_lo":-8.153159694848053e-5,"ci_hi":7.671773796366754e-5,"zero":0},
{"x":19,"irf":-4.902933665197481e-6,"ci_lo":-5.8348066494385455e-5,"ci_hi":4.585397267805317e-5,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_5');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":-0.00020078903085769343,"ci_lo":-0.00032905196535853326,"ci_hi":-5.26439214729651e-5,"zero":0},
{"x":1,"irf":0.00015707185464226928,"ci_lo":-2.4004118995505265e-5,"ci_hi":0.0003337205687872829,"zero":0},
{"x":2,"irf":0.0002148433870277908,"ci_lo":-5.6775218616008605e-6,"ci_hi":0.000377516027007516,"zero":0},
{"x":3,"irf":6.621813476470337e-6,"ci_lo":-0.0001653858165824089,"ci_hi":0.0001938049209812337,"zero":0},
{"x":4,"irf":-8.360261029503238e-5,"ci_lo":-0.00027580794802038733,"ci_hi":8.70160382577335e-5,"zero":0},
{"x":5,"irf":-3.7620660095451114e-5,"ci_lo":-0.00015244770304351476,"ci_hi":7.878834831127726e-5,"zero":0},
{"x":6,"irf":-1.565662268211511e-6,"ci_lo":-4.497158724735339e-5,"ci_hi":5.1084623189515346e-5,"zero":0},
{"x":7,"irf":2.5159579699385534e-5,"ci_lo":-1.5298814739162053e-5,"ci_hi":6.521489829581343e-5,"zero":0},
{"x":8,"irf":9.636515308841229e-6,"ci_lo":-1.7598169366143455e-5,"ci_hi":4.579386421317152e-5,"zero":0},
{"x":9,"irf":-8.48339148984325e-6,"ci_lo":-3.603394182506862e-5,"ci_hi":1.8965748004759348e-5,"zero":0},
{"x":10,"irf":-6.130314382671807e-6,"ci_lo":-2.225972645125971e-5,"ci_hi":6.267846389633948e-6,"zero":0},
{"x":11,"irf":9.991621065971693e-9,"ci_lo":-1.0180118191330765e-5,"ci_hi":1.0476788797950368e-5,"zero":0},
{"x":12,"irf":3.5368883050517903e-6,"ci_lo":-2.207858179431475e-6,"ci_hi":1.1196270501224165e-5,"zero":0},
{"x":13,"irf":1.5290463879217475e-6,"ci_lo":-2.4513728287513013e-6,"ci_hi":7.421443383275278e-6,"zero":0},
{"x":14,"irf":-1.2792658981821112e-6,"ci_lo":-5.550878534963337e-6,"ci_hi":2.613088280443107e-6,"zero":0},
{"x":15,"irf":-1.1602133822229513e-6,"ci_lo":-4.68415848393651e-6,"ci_hi":8.634040544920355e-7,"zero":0},
{"x":16,"irf":3.801803435481068e-8,"ci_lo":-2.2519692752333637e-6,"ci_hi":1.9112857267394427e-6,"zero":0},
{"x":17,"irf":5.888326865531517e-7,"ci_lo":-4.1180349951029977e-7,"ci_hi":2.232850515375224e-6,"zero":0},
{"x":18,"irf":2.6116900474077376e-7,"ci_lo":-6.113371854428767e-7,"ci_hi":1.7694321344996934e-6,"zero":0},
{"x":19,"irf":-1.8346270333530163e-7,"ci_lo":-1.037845956070277e-6,"ci_hi":6.692877207622469e-7,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_6');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":0.0,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":1,"irf":0.0010811803277320296,"ci_lo":0.0004537392761928815,"ci_hi":0.0016469182410005054,"zero":0},
{"x":2,"irf":0.0001716801342491788,"ci_lo":-0.0004057323631367402,"ci_hi":0.0007549801962097043,"zero":0},
{"x":3,"irf":-5.1915295741719505e-5,"ci_lo":-0.0006166919200501001,"ci_hi":0.000594562914897411,"zero":0},
{"x":4,"irf":-0.00013084720595813611,"ci_lo":-0.0007778022089527308,"ci_hi":0.0004482490478300992,"zero":0},
{"x":5,"irf":-0.00013823341901802186,"ci_lo":-0.00048677514848778126,"ci_hi":0.00018123886365456978,"zero":0},
{"x":6,"irf":7.63328954760714e-5,"ci_lo":-0.00015666330776088657,"ci_hi":0.0003267403659369245,"zero":0},
{"x":7,"irf":7.806227531795806e-5,"ci_lo":-5.702131981474326e-5,"ci_hi":0.0002433618034688175,"zero":0},
{"x":8,"irf":1.6654335354296477e-5,"ci_lo":-0.00011685821813198465,"ci_hi":0.000153739242869268,"zero":0},
{"x":9,"irf":-3.167424136314592e-5,"ci_lo":-0.00011801922155424672,"ci_hi":4.10329890300588e-5,"zero":0},
{"x":10,"irf":-2.1861586524927557e-5,"ci_lo":-8.673032561041551e-5,"ci_hi":2.99451961346626e-5,"zero":0},
{"x":11,"irf":8.661820503922879e-6,"ci_lo":-3.6515963604097155e-5,"ci_hi":5.9298785209453366e-5,"zero":0},
{"x":12,"irf":1.2636106004065323e-5,"ci_lo":-7.606795691980391e-6,"ci_hi":4.108997044597839e-5,"zero":0},
{"x":13,"irf":2.2665101874471775e-6,"ci_lo":-2.211227533261707e-5,"ci_hi":2.8456477036565174e-5,"zero":0},
{"x":14,"irf":-5.31198254204745e-6,"ci_lo":-2.1669252912938312e-5,"ci_hi":8.671234149395835e-6,"zero":0},
{"x":15,"irf":-3.403398649675425e-6,"ci_lo":-1.5249492257921805e-5,"ci_hi":6.373095662833952e-6,"zero":0},
{"x":16,"irf":1.174444800325168e-6,"ci_lo":-7.78469229318806e-6,"ci_hi":1.0959684764398197e-5,"zero":0},
{"x":17,"irf":2.117574407572372e-6,"ci_lo":-1.5376974729224856e-6,"ci_hi":8.475999348736531e-6,"zero":0},
{"x":18,"irf":4.2904656952501287e-7,"ci_lo":-4.084611908779579e-6,"ci_hi":5.628676056151527e-6,"zero":0},
{"x":19,"irf":-8.523483983452106e-7,"ci_lo":-4.0529723175285336e-6,"ci_hi":2.2318073427379183e-6,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_7');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":0.0,"ci_lo":0.0,"ci_hi":0.0,"zero":0},
{"x":1,"irf":-0.035486927703420205,"ci_lo":-0.06271690948602598,"ci_hi":-0.005737232464081434,"zero":0},
{"x":2,"irf":-0.014195820578043439,"ci_lo":-0.04828294178115582,"ci_hi":0.016302249395608103,"zero":0},
{"x":3,"irf":-0.004125332591280332,"ci_lo":-0.036118637422181514,"ci_hi":0.021075076365799573,"zero":0},
{"x":4,"irf":0.012688289245706216,"ci_lo":-0.01185896225590297,"ci_hi":0.041879236190787594,"zero":0},
{"x":5,"irf":0.005622587858966226,"ci_lo":-0.015086615799837564,"ci_hi":0.02673445065994852,"zero":0},
{"x":6,"irf":-0.0027247435725734647,"ci_lo":-0.014446211894168597,"ci_hi":0.006410808587400316,"zero":0},
{"x":7,"irf":-0.003602190766401388,"ci_lo":-0.010225304687284085,"ci_hi":0.00292997258412401,"zero":0},
{"x":8,"irf":-0.0014425521796759876,"ci_lo":-0.007312187639033669,"ci_hi":0.0034957106510314084,"zero":0},
{"x":9,"irf":0.0017846273628771491,"ci_lo":-0.002317283110329256,"ci_hi":0.00660797939187288,"zero":0},
{"x":10,"irf":0.001047492813965184,"ci_lo":-0.0014698278900197558,"ci_hi":0.004220931576865376,"zero":0},
{"x":11,"irf":-0.0003488614142684389,"ci_lo":-0.0026837501610476678,"ci_hi":0.0013947702825422446,"zero":0},
{"x":12,"irf":-0.0005889989983643568,"ci_lo":-0.0018574122412141993,"ci_hi":0.000561787327317068,"zero":0},
{"x":13,"irf":-0.00017530571501820703,"ci_lo":-0.0011308756979961042,"ci_hi":0.0006916821642984437,"zero":0},
{"x":14,"irf":0.0002596308762344658,"ci_lo":-0.0003884902496085731,"ci_hi":0.0010353884646280152,"zero":0},
{"x":15,"irf":0.00018139352484089214,"ci_lo":-0.00022559433819483636,"ci_hi":0.0008165414355401009,"zero":0},
{"x":16,"irf":-4.741852879506941e-5,"ci_lo":-0.00047486977766915807,"ci_hi":0.00030203778240275143,"zero":0},
{"x":17,"irf":-0.00010353582252379613,"ci_lo":-0.00040052445741774444,"ci_hi":8.658586886368041e-5,"zero":0},
{"x":18,"irf":-2.8398242524790423e-5,"ci_lo":-0.0002373425118800504,"ci_hi":0.0001597455069168264,"zero":0},
{"x":19,"irf":3.9623626909153384e-5,"ci_lo":-9.728645035647243e-5,"ci_hi":0.00022022656841235518,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_8');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":0,"irf":0.0023854027968895552,"ci_lo":0.002142502367282904,"ci_hi":0.00257151280544383,"zero":0},
{"x":1,"irf":-0.0010836461498761579,"ci_lo":-0.001273487094184793,"ci_hi":-0.0008675701567164555,"zero":0},
{"x":2,"irf":-0.0004189302226593562,"ci_lo":-0.000624262827431103,"ci_hi":-0.00022488706220995692,"zero":0},
{"x":3,"irf":-0.00013204636945151664,"ci_lo":-0.00029030926677687673,"ci_hi":3.359612674196836e-5,"zero":0},
{"x":4,"irf":0.00020019996226663207,"ci_lo":4.061212773292947e-5,"ci_hi":0.0003891386917683806,"zero":0},
{"x":5,"irf":0.0002352240447607231,"ci_lo":7.758834287224008e-5,"ci_hi":0.0003892130813105667,"zero":0},
{"x":6,"irf":-7.961350684080138e-5,"ci_lo":-0.00015048210131739866,"ci_hi":-1.3742910359854601e-5,"zero":0},
{"x":7,"irf":-9.267020203341718e-5,"ci_lo":-0.00016277710323173622,"ci_hi":-3.592201763429873e-5,"zero":0},
{"x":8,"irf":-2.903189762435319e-5,"ci_lo":-8.070712249994238e-5,"ci_hi":2.5181707079818377e-5,"zero":0},
{"x":9,"irf":3.927833305266409e-5,"ci_lo":4.609702336590224e-6,"ci_hi":8.264529831034301e-5,"zero":0},
{"x":10,"irf":3.268472674788324e-5,"ci_lo":2.5155231372017246e-6,"ci_hi":7.456092199289936e-5,"zero":0},
{"x":11,"irf":-7.636123009514754e-6,"ci_lo":-3.1547417458075827e-5,"ci_hi":1.2233924495139791e-5,"zero":0},
{"x":12,"irf":-1.6793732077622288e-5,"ci_lo":-3.9625408724921246e-5,"ci_hi":-3.467991346390851e-6,"zero":0},
{"x":13,"irf":-5.138543659231538e-6,"ci_lo":-2.2099376829969294e-5,"ci_hi":8.516759279606247e-6,"zero":0},
{"x":14,"irf":6.395183342768008e-6,"ci_lo":-2.0870947912510167e-6,"ci_hi":1.7883185135974274e-5,"zero":0},
{"x":15,"irf":5.266922743746409e-6,"ci_lo":-1.0372292305414082e-6,"ci_hi":1.6673905674017323e-5,"zero":0},
{"x":16,"irf":-8.429019315967068e-7,"ci_lo":-7.358908803643645e-6,"ci_hi":5.5455831566941505e-6,"zero":0},
{"x":17,"irf":-2.831471078894045e-6,"ci_lo":-9.381798526420385e-6,"ci_hi":-8.100382804672132e-8,"zero":0},
{"x":18,"irf":-9.216161995228278e-7,"ci_lo":-5.3443850576548695e-6,"ci_hi":2.2915253384170064e-6,"zero":0},
{"x":19,"irf":9.963610326980612e-7,"ci_lo":-1.0424187654378933e-6,"ci_hi":3.942305052796502e-6,"zero":0}];
    const series = [{"name":"IRF","color":"#1f77b4","key":"irf","dash":""}];
    const bands = [{"lo_key":"ci_lo","hi_key":"ci_hi","color":"#1f77b4","alpha":0.15}];
    const refLines = [{"value":0,"color":"#999","dash":"4,3"}];

    const container = d3.select('#irf_9');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    // Compute domains
    const xVals = data.map(d => d.x);
    const allYVals = [];
    series.forEach(s => data.forEach(d => { if(d[s.key]!==null) allYVals.push(d[s.key]); }));
    bands.forEach(b => data.forEach(d => {
        if(d[b.lo_key]!==null) allYVals.push(d[b.lo_key]);
        if(d[b.hi_key]!==null) allYVals.push(d[b.hi_key]);
    }));
    refLines.forEach(r => allYVals.push(r.value));

    const x = d3.scaleLinear().domain(d3.extent(xVals)).range([0,w]);
    const yExt = d3.extent(allYVals);
    const yPad = (yExt[1]-yExt[0])*0.08 || 1;
    const y = d3.scaleLinear().domain([yExt[0]-yPad, yExt[1]+yPad]).range([h,0]);

    // Grid
    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));

    // Bands
    bands.forEach(b => {
        const area = d3.area()
            .x(d => x(d.x))
            .y0(d => y(d[b.lo_key]!==null ? d[b.lo_key] : 0))
            .y1(d => y(d[b.hi_key]!==null ? d[b.hi_key] : 0))
            .defined(d => d[b.lo_key]!==null && d[b.hi_key]!==null);
        g.append('path').datum(data).attr('d',area)
            .attr('fill',b.color).attr('opacity',b.alpha||0.15);
    });

    // Reference lines
    refLines.forEach(r => {
        g.append('line').attr('x1',0).attr('x2',w)
            .attr('y1',y(r.value)).attr('y2',y(r.value))
            .attr('stroke',r.color||'#999').attr('stroke-width',1)
            .attr('stroke-dasharray',r.dash||'4,3');
    });

    // Lines
    series.forEach(s => {
        const line = d3.line().x(d=>x(d.x)).y(d=>y(d[s.key]))
            .defined(d=>d[s.key]!==null);
        g.append('path').datum(data).attr('d',line)
            .attr('fill','none').attr('stroke',s.color).attr('stroke-width',1.8)
            .attr('stroke-dasharray',s.dash||'');
    });

    // Axes
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(xVals.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(6));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Response') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Response');

    // Legend
    if(series.length > 1) {
        const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
        series.forEach((s,i) => {
            const gi = leg.append('g').attr('transform','translate('+(i*100)+',0)');
            gi.append('line').attr('x1',0).attr('x2',16).attr('y1',0).attr('y2',0)
                .attr('stroke',s.color).attr('stroke-width',2)
                .attr('stroke-dasharray',s.dash||'');
            gi.append('text').attr('x',20).attr('y',4).attr('font-size','10px')
                .attr('fill','#555').text(s.name);
        });
    }

    // Tooltip overlay
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>x='+fmt(d.x)+'</b>';
            series.forEach(s => { if(d[s.key]!==null) html += '<br>'+s.name+': '+fmt(d[s.key]); });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>