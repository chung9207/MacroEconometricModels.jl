<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bayesian FEVD (posterior mean)</title>
<style>* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    background: #fff;
    color: #333;
    padding: 20px;
}
.figure-title {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 16px;
    color: #222;
}
.figure-source {
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
}
.panel-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
}
.panel {
    width: calc(33% - 16px);
    min-width: 300px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
}
.panel-title {
    font-size: 13px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 8px;
    color: #444;
}
.axis text { font-size: 11px; fill: #666; }
.axis line, .axis path { stroke: #ccc; }
.grid line { stroke: #f0f0f0; stroke-dasharray: 2,2; }
.grid .domain { stroke: none; }
.tooltip {
    position: absolute;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
}
.legend { font-size: 11px; }
.legend rect { rx: 2; }
svg { overflow: visible; }
</style>
</head>
<body>
<div class="figure-title">Bayesian FEVD (posterior mean)</div>
<div class="panel-grid">
<div class="panel">
<div class="panel-title">INDPRO</div>
<div id="bfevd_43"></div>
</div>
<div class="panel">
<div class="panel-title">UNRATE</div>
<div id="bfevd_44"></div>
</div>
<div class="panel">
<div class="panel-title">CPI</div>
<div id="bfevd_45"></div>
</div>
</div>

<div class="tooltip" id="tooltip"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<script>
// Shared utilities
const tooltip = d3.select('#tooltip');
function fmt(v) {
    if (v === null || v === undefined) return '';
    return Math.abs(v) >= 1000 ? v.toFixed(1) : (Math.abs(v) >= 1 ? v.toFixed(3) : v.toFixed(4));
}
function showTip(evt, html) {
    tooltip.html(html).style('opacity',1)
        .style('left',(evt.pageX+12)+'px').style('top',(evt.pageY-28)+'px');
}
function hideTip() { tooltip.style('opacity',0); }

(function() {
    const data = [{"x":1,"s1":1.0,"s2":0.0,"s3":0.0},
{"x":2,"s1":0.9222368197127879,"s2":0.0019074186774611405,"s3":0.07585576160975091},
{"x":3,"s1":0.8611605106314608,"s2":0.006063212358875035,"s3":0.13277627700966413},
{"x":4,"s1":0.8077597120748747,"s2":0.008247051535140486,"s3":0.18399323638998483},
{"x":5,"s1":0.7620555796736608,"s2":0.009303868351877048,"s3":0.2286405519744623},
{"x":6,"s1":0.7473781232667797,"s2":0.009650129859926604,"s3":0.24297174687329368},
{"x":7,"s1":0.733432250925239,"s2":0.009915755736092867,"s3":0.25665199333866817},
{"x":8,"s1":0.7221545979184036,"s2":0.010109957906546157,"s3":0.2677354441750502},
{"x":9,"s1":0.713399232692412,"s2":0.010246583649599572,"s3":0.27635418365798853},
{"x":10,"s1":0.7057787695076365,"s2":0.0103174881923614,"s3":0.2839037423000021},
{"x":11,"s1":0.6993337591055034,"s2":0.010369707467206198,"s3":0.29029653342729034},
{"x":12,"s1":0.6935521230773343,"s2":0.010413095311883792,"s3":0.29603478161078195},
{"x":13,"s1":0.688553839773369,"s2":0.010427325196404082,"s3":0.3010188350302269},
{"x":14,"s1":0.6842210959781735,"s2":0.010444594706516874,"s3":0.30533430931530964},
{"x":15,"s1":0.6803185384281346,"s2":0.010449882368853093,"s3":0.3092315792030123},
{"x":16,"s1":0.6766307175222962,"s2":0.010440818786548992,"s3":0.3129284636911546},
{"x":17,"s1":0.6731446222059297,"s2":0.010445364710455903,"s3":0.3164100130836143},
{"x":18,"s1":0.6703599611102083,"s2":0.010449929558890769,"s3":0.3191901093309009},
{"x":19,"s1":0.6675905099650667,"s2":0.010436286519294243,"s3":0.32197320351563896},
{"x":20,"s1":0.6649846711616925,"s2":0.010437922599568987,"s3":0.32457740623873843}];
    const series = [{"name":"INDPRO","color":"#1f77b4","key":"s1","dash":""},{"name":"UNRATE","color":"#ff7f0e","key":"s2","dash":""},{"name":"CPI","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#bfevd_43');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"s1":0.025122309751968486,"s2":0.9748776902480315,"s3":0.0},
{"x":2,"s1":0.48148128086114933,"s2":0.4344002490636324,"s3":0.08411847007521828},
{"x":3,"s1":0.46112329971256977,"s2":0.3915558396695995,"s3":0.14732086061783073},
{"x":4,"s1":0.45509794231246975,"s2":0.34701899271882153,"s3":0.19788306496870872},
{"x":5,"s1":0.44944319701250884,"s2":0.31126969937053117,"s3":0.2392871036169599},
{"x":6,"s1":0.43698897293140465,"s2":0.2934067801926226,"s3":0.2696042468759728},
{"x":7,"s1":0.43205338515622443,"s2":0.2844432946556707,"s3":0.2835033201881048},
{"x":8,"s1":0.4273530201812101,"s2":0.2765372736108019,"s3":0.2961097062079881},
{"x":9,"s1":0.4235064679968474,"s2":0.2703856084076065,"s3":0.3061079235955461},
{"x":10,"s1":0.420337967436081,"s2":0.2657179996746566,"s3":0.3139440328892625},
{"x":11,"s1":0.4175880031349134,"s2":0.26217174917094516,"s3":0.3202402476941414},
{"x":12,"s1":0.4149634362669816,"s2":0.25887471546659985,"s3":0.3261618482664186},
{"x":13,"s1":0.41241949676104905,"s2":0.25597451361136825,"s3":0.3316059896275826},
{"x":14,"s1":0.4100860342121813,"s2":0.25344742653159413,"s3":0.3364665392562246},
{"x":15,"s1":0.40820330932928833,"s2":0.2513395832797221,"s3":0.3404571073909896},
{"x":16,"s1":0.4061702887047649,"s2":0.24927525297674963,"s3":0.3445544583184854},
{"x":17,"s1":0.4043001677653994,"s2":0.24749030442276182,"s3":0.3482095278118388},
{"x":18,"s1":0.4027016609770079,"s2":0.24588921088200513,"s3":0.35140912814098696},
{"x":19,"s1":0.40133077587534344,"s2":0.2444661298606952,"s3":0.35420309426396135},
{"x":20,"s1":0.399937304181654,"s2":0.24311430021439406,"s3":0.356948395603952}];
    const series = [{"name":"INDPRO","color":"#1f77b4","key":"s1","dash":""},{"name":"UNRATE","color":"#ff7f0e","key":"s2","dash":""},{"name":"CPI","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#bfevd_44');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

(function() {
    const data = [{"x":1,"s1":0.00116469392483471,"s2":0.0012803054559023962,"s3":0.9975550006192628},
{"x":2,"s1":0.022878011344968474,"s2":0.0029992271867212523,"s3":0.9741227614683102},
{"x":3,"s1":0.04175969737673947,"s2":0.004396796352689357,"s3":0.9538435062705711},
{"x":4,"s1":0.05860812936145102,"s2":0.0058033500806730885,"s3":0.935588520557876},
{"x":5,"s1":0.07179204032459562,"s2":0.006990229843171183,"s3":0.9212177298322333},
{"x":6,"s1":0.07574618204996152,"s2":0.007344409669019,"s3":0.9169094082810195},
{"x":7,"s1":0.07867360632751294,"s2":0.0075721155904366014,"s3":0.9137542780820505},
{"x":8,"s1":0.08097131987348458,"s2":0.007733144133323008,"s3":0.9112955359931925},
{"x":9,"s1":0.0828599272491705,"s2":0.00784698143951048,"s3":0.9092930913113191},
{"x":10,"s1":0.08432081694226899,"s2":0.007956205178289457,"s3":0.9077229778794416},
{"x":11,"s1":0.08527848084266114,"s2":0.008013449173107687,"s3":0.906708069984231},
{"x":12,"s1":0.08630264790085941,"s2":0.008046533432302196,"s3":0.9056508186668383},
{"x":13,"s1":0.08694981100721066,"s2":0.008089122135713568,"s3":0.9049610668570758},
{"x":14,"s1":0.08763358042480378,"s2":0.00812568839022405,"s3":0.9042407311849722},
{"x":15,"s1":0.08796711974602069,"s2":0.008143000660414592,"s3":0.9038898795935648},
{"x":16,"s1":0.08854862419967409,"s2":0.008168291801285293,"s3":0.9032830839990406},
{"x":17,"s1":0.08884960762610873,"s2":0.008175338628826178,"s3":0.902975053745065},
{"x":18,"s1":0.08929036106463545,"s2":0.00818428860940843,"s3":0.9025253503259562},
{"x":19,"s1":0.08977396284583838,"s2":0.008212767506807078,"s3":0.9020132696473545},
{"x":20,"s1":0.09009607266103814,"s2":0.008220392722643811,"s3":0.9016835346163181}];
    const series = [{"name":"INDPRO","color":"#1f77b4","key":"s1","dash":""},{"name":"UNRATE","color":"#ff7f0e","key":"s2","dash":""},{"name":"CPI","color":"#2ca02c","key":"s3","dash":""}];

    const container = d3.select('#bfevd_45');
    const W = Math.max(container.node().clientWidth - 24, 280);
    const margin = {top:10, right:15, bottom:35, left:55};
    const w = W - margin.left - margin.right;
    const h = Math.min(w * 0.6, 250);

    const svg = container.append('svg').attr('width', W).attr('height', h + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', 'translate('+margin.left+','+margin.top+')');

    const keys = series.map(s => s.key);
    const x = d3.scaleLinear().domain(d3.extent(data, d=>d.x)).range([0,w]);
    const y = d3.scaleLinear().domain([0,1]).range([h,0]);

    const stack = d3.stack().keys(keys).order(d3.stackOrderNone).offset(d3.stackOffsetNone);
    const stacked = stack(data);

    const area = d3.area()
        .x(d => x(d.data.x))
        .y0(d => y(d[0]))
        .y1(d => y(d[1]));

    g.selectAll('.layer').data(stacked).join('path')
        .attr('class','layer')
        .attr('d', area)
        .attr('fill', (d,i) => series[i].color)
        .attr('opacity', 0.85);

    g.append('g').attr('class','grid').call(d3.axisLeft(y).tickSize(-w).tickFormat(''));
    g.append('g').attr('class','axis').attr('transform','translate(0,'+h+')')
        .call(d3.axisBottom(x).ticks(Math.min(data.length,8)));
    g.append('g').attr('class','axis').call(d3.axisLeft(y).ticks(5).tickFormat(d3.format('.0%')));

    if('Horizon') g.append('text').attr('x',w/2).attr('y',h+30).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Horizon');
    if('Proportion') g.append('text').attr('transform','rotate(-90)')
        .attr('x',-h/2).attr('y',-42).attr('text-anchor','middle')
        .attr('font-size','11px').attr('fill','#666').text('Proportion');

    // Legend
    const leg = g.append('g').attr('class','legend').attr('transform','translate(5,-5)');
    series.forEach((s,i) => {
        const gi = leg.append('g').attr('transform','translate('+(i*90)+',0)');
        gi.append('rect').attr('width',12).attr('height',12).attr('y',-6).attr('fill',s.color).attr('opacity',0.85);
        gi.append('text').attr('x',16).attr('y',4).attr('font-size','10px').attr('fill','#555').text(s.name);
    });

    // Tooltip
    svg.append('rect').attr('width',W).attr('height',h+margin.top+margin.bottom)
        .attr('fill','none').attr('pointer-events','all')
        .on('mousemove', function(evt) {
            const [mx] = d3.pointer(evt, g.node());
            const x0 = x.invert(mx);
            const idx = d3.minIndex(data, d => Math.abs(d.x - x0));
            const d = data[idx];
            let html = '<b>h='+d.x+'</b>';
            series.forEach(s => { html += '<br>'+s.name+': '+(d[s.key]*100).toFixed(1)+'%'; });
            showTip(evt, html);
        })
        .on('mouseout', hideTip);
})();

</script>
</body>
</html>